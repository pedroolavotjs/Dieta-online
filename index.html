<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Dieta na Ponta do L√°pis - Controle Nutricional Completo</title>
    <meta name="description" content="Controle nutricional completo para seus objetivos de sa√∫de e bem-estar. Acompanhe calorias, macronutrientes, peso e medidas.">
    <meta name="keywords" content="dieta, nutri√ß√£o, controle cal√≥rico, macronutrientes, emagrecer, ganhar massa, sa√∫de, bem-estar, fitness">
    <meta name="author" content="BLACKBOX.AI Assistant">
    <!-- Favicon e Apple Touch Icon em SVG inline para evitar requisi√ß√µes HTTP adicionais -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçé</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçé</text></svg>">
    
    <!-- PWA related meta tags para uma experi√™ncia de app-like -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#4CAF50">

    <!-- Tailwind CSS CDN - Para projetos maiores, considerar compilar o Tailwind para purgar o CSS n√£o utilizado -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js e plugins CDN - Carregamento deferido para n√£o bloquear o render inicial -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0" defer></script>

    <style>
        /* Base styles for tab content */
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }
        .tab-content.active {
            display: block;
        }

        /* Keyframe for fade-in animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Nutrition circles for macro display */
        .nutrition-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            margin: 0 auto;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            touch-action: manipulation; /* Melhora a responsividade em dispositivos de toque */
        }
        .nutrition-circle:hover {
            transform: translateY(-5px);
        }

        /* Progress bars for daily tracking */
        .progress-bar {
            height: 16px;
            border-radius: 8px;
            overflow: hidden;
            background-color: #e0e0e0;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .progress-fill {
            height: 100%;
            width: 0%;
            transition: width 0.5s ease-out, background-color 0.3s ease;
            border-radius: 8px;
        }
        .progress-fill.over-target {
            background-color: #ef4444; /* Vermelho para quando excede o alvo */
        }

        /* Pulse animation for progress bars */
        .animate-pulse-custom {
            animation: pulse-custom 1.5s infinite cubic-bezier(0.4, 0, 0.6, 1);
        }
        @keyframes pulse-custom {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        /* Loading spinner */
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4CAF50; /* Green-500 */
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-left: 6px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Feedback stars */
        .star-btn {
            cursor: pointer;
            transition: transform 0.2s ease, color 0.2s ease;
            touch-action: manipulation; /* Melhora a responsividade em dispositivos de toque */
        }
        .star-btn:hover {
            transform: scale(1.2);
        }
        .star-btn.selected {
            color: #FFD700; /* Gold */
        }

        /* Custom scrollbar for tables */
        .overflow-x-auto::-webkit-scrollbar {
            height: 8px;
        }
        .overflow-x-auto::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .overflow-x-auto::-webkit-scrollbar-thumb {
            background: #a5d6a7; /* Light Green */
            border-radius: 10px;
        }
        .overflow-x-auto::-webkit-scrollbar-thumb:hover {
            background: #81c784; /* Medium Green */
        }

        /* Estilos para a nova se√ß√£o de obst√°culos/solu√ß√µes (mantido para refer√™ncia, mas removido do HTML) */
        .solution-card {
            background-color: #e8f5e9; /* Green-50 */
            border-left: 4px solid #4CAF50; /* Green-500 */
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            animation: fadeIn 0.5s ease-out;
        }
        .solution-card h5 {
            color: #2E7D32; /* Green-800 */
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        .solution-card p {
            color: #424242; /* Grey-800 */
        }

        /* Mobile-specific adjustments */
        @media (max-width: 767px) {
            .container {
                padding: 1rem;
            }
            header h1 {
                font-size: 2.5rem;
            }
            header p {
                font-size: 1rem;
            }
            .tab-btn {
                flex-grow: 1;
                text-align: center;
                margin-bottom: 0.5rem;
                padding: 0.75rem 0.5rem; /* √Årea de toque maior */
                font-size: 0.9rem;
            }
            .grid-cols-1\.5-mobile {
                grid-template-columns: 1fr 1.5fr;
            }
            .nutrition-circle {
                width: 100px;
                height: 100px;
                font-size: 0.9rem;
            }
            .nutrition-circle .text-3xl {
                font-size: 2rem;
            }
            .nutrition-circle .text-sm {
                font-size: 0.75rem;
            }
            .progress-bar {
                height: 12px;
            }
            .daily-summary-grid {
                grid-template-columns: 1fr;
            }
            .daily-summary-grid > div {
                padding: 0.75rem;
            }
            .daily-summary-grid .font-bold {
                font-size: 1.1rem;
            }
            .daily-summary-grid .text-sm {
                font-size: 0.8rem;
            }
            .add-meal-form-grid {
                grid-template-columns: 1fr;
            }
            .add-meal-form-grid > div {
                margin-bottom: 1rem;
            }
            .add-meal-form-grid .flex {
                flex-direction: row; /* Manter quantidade e unidade na mesma linha */
            }
            .add-meal-form-grid button {
                width: 100%;
                padding: 0.75rem 1rem; /* √Årea de toque maior */
            }
            .daily-meals-table th, .daily-meals-table td {
                padding: 0.5rem;
                font-size: 0.8rem;
            }
            .daily-meals-table .text-sm {
                font-size: 0.7rem;
            }
            .daily-meals-table .text-xs {
                font-size: 0.6rem;
            }
            .daily-meals-table button {
                font-size: 0.7rem;
            }
            .meal-template-form-grid, .measurements-form-grid {
                grid-template-columns: 1fr;
            }
            .meal-template-form-grid > div, .measurements-form-grid > div {
                margin-bottom: 1rem;
            }
            .measurements-history-table th, .measurements-history-table td {
                padding: 0.5rem;
                font-size: 0.75rem;
            }
            .measurements-history-table .text-sm {
                font-size: 0.7rem;
            }
            .measurements-history-table button {
                font-size: 0.7rem;
            }
            .journal-textarea {
                height: 100px;
            }
            .obstacles-select {
                height: 150px;
            }

            /* Garantir que os inputs de formul√°rio sejam grandes o suficiente para toque */
            input[type="text"],
            input[type="number"],
            input[type="date"],
            select,
            textarea {
                min-height: 48px; /* Tamanho de alvo de toque recomendado */
                padding: 0.75rem;
            }
        }

        /* Custom styles for better table display on mobile */
        @media (max-width: 767px) {
            .responsive-table {
                border: 0;
            }
            .responsive-table thead {
                display: none;
            }
            .responsive-table tr {
                display: block;
                margin-bottom: 0.625em;
                border: 1px solid #ddd;
                border-radius: 0.5rem;
                background-color: #fff;
                box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            }
            .responsive-table td {
                display: block;
                text-align: right;
                padding-left: 50%;
                position: relative;
                border-bottom: 1px solid #eee;
            }
            .responsive-table td::before {
                content: attr(data-label);
                position: absolute;
                left: 0;
                width: 45%;
                padding-left: 10px;
                font-weight: bold;
                text-align: left;
                color: #4A5568;
            }
            .responsive-table td:last-child {
                border-bottom: 0;
            }
        }

        /* General button styling for better touch feedback */
        button {
            -webkit-tap-highlight-color: transparent; /* Remove o destaque de toque padr√£o no iOS */
            touch-action: manipulation; /* Previne o zoom de duplo toque */
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800">
    <div class="container mx-auto p-4 max-w-6xl">
        <header class="bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-xl shadow-lg p-6 mb-6 transform transition-all duration-300 hover:scale-[1.01]">
            <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight mb-2 text-center">Dieta na Ponta do L√°pis</h1>
            <p class="text-lg md:text-xl opacity-90 text-center">Seu controle nutricional completo para alcan√ßar seus objetivos de forma inteligente.</p>
        </header>

        <nav class="flex flex-wrap justify-center gap-2 mb-6 bg-white rounded-xl shadow-md p-3 overflow-x-auto" role="tablist">
            <button class="tab-btn px-4 py-2 rounded-lg text-green-700 bg-green-100 font-semibold hover:bg-green-200 transition-colors duration-200 whitespace-nowrap" data-tab="dados-pessoais" role="tab" aria-selected="true" aria-controls="dados-pessoais-panel">Dados Pessoais</button>
            <button class="tab-btn px-4 py-2 rounded-lg text-gray-700 hover:bg-green-50 hover:text-green-600 font-medium transition-colors duration-200 whitespace-nowrap" data-tab="controle-diario" role="tab" aria-selected="false" aria-controls="controle-diario-panel">Di√°rio Alimentar</button>
            <button class="tab-btn px-4 py-2 rounded-lg text-gray-700 hover:bg-green-50 hover:text-green-600 font-medium transition-colors duration-200 whitespace-nowrap" data-tab="refeicoes" role="tab" aria-selected="false" aria-controls="refeicoes-panel">Planejamento de Refei√ß√µes</button>
            <button class="tab-btn px-4 py-2 rounded-lg text-gray-700 hover:bg-green-50 hover:text-green-600 font-medium transition-colors duration-200 whitespace-nowrap" data-tab="evolucao" role="tab" aria-selected="false" aria-controls="evolucao-panel">Evolu√ß√£o</button>
            <button class="tab-btn px-4 py-2 rounded-lg text-gray-700 hover:bg-green-50 hover:text-green-600 font-medium transition-colors duration-200 whitespace-nowrap" data-tab="diario" role="tab" aria-selected="false" aria-controls="diario-panel">Di√°rio</button>
            <button class="tab-btn px-4 py-2 rounded-lg text-gray-700 hover:bg-green-50 hover:text-green-600 font-medium transition-colors duration-200 whitespace-nowrap" data-tab="feedback" role="tab" aria-selected="false" aria-controls="feedback-panel">Feedback</button>
        </nav>

        <main>
            <!-- Aba Dados Pessoais -->
            <section id="dados-pessoais" class="tab-content bg-white rounded-xl shadow-md p-4 md:p-6 active" role="tabpanel" aria-labelledby="dados-pessoais-tab">
                <h2 class="text-2xl md:text-3xl font-bold mb-4 md:mb-6 text-green-700 border-b pb-2 md:pb-3 border-green-100">Seu Perfil Nutricional</h2>
                
                <form id="personal-data-form" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
                    <div>
                        <label for="name" class="block text-gray-700 font-medium mb-1 md:mb-2">Nome (opcional)</label>
                        <input type="text" id="name" class="w-full p-2 md:p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-400 focus:border-transparent transition-all duration-200" placeholder="Seu nome">
                    </div>
                    
                    <div>
                        <label for="gender" class="block text-gray-700 font-medium mb-1 md:mb-2">Sexo</label>
                        <select id="gender" class="w-full p-2 md:p-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-green-400 focus:border-transparent transition-all duration-200">
                            <option value="M">Masculino</option>
                            <option value="F">Feminino</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="age" class="block text-gray-700 font-medium mb-1 md:mb-2">Idade</label>
                        <input type="number" id="age" class="w-full p-2 md:p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-400 focus:border-transparent transition-all duration-200" placeholder="Ex: 30">
                    </div>
                    
                    <div>
                        <label for="height" class="block text-gray-700 font-medium mb-1 md:mb-2">Altura (cm)</label>
                        <input type="number" id="height" class="w-full p-2 md:p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-400 focus:border-transparent transition-all duration-200" placeholder="Ex: 175">
                    </div>
                    
                    <div>
                        <label for="weight" class="block text-gray-700 font-medium mb-1 md:mb-2">Peso atual (kg)</label>
                        <input type="number" id="weight" step="0.1" class="w-full p-2 md:p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-400 focus:border-transparent transition-all duration-200" placeholder="Ex: 70.5">
                    </div>
                    
                    <div>
                        <label for="activity" class="block text-gray-700 font-medium mb-1 md:mb-2">N√≠vel de atividade f√≠sica</label>
                        <select id="activity" class="w-full p-2 md:p-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-green-400 focus:border-transparent transition-all duration-200">
                            <option value="1.2">Sedent√°rio (pouco ou nenhum exerc√≠cio)</option>
                            <option value="1.375">Leve (exerc√≠cio leve 1-2 dias/semana)</option>
                            <option value="1.55">Moderado (exerc√≠cio moderado 3-5 dias/semana)</option>
                            <option value="1.725">Intenso (exerc√≠cio intenso 6-7 dias/semana)</option>
                            <option value="1.9">Muito intenso (exerc√≠cio muito intenso e trabalho f√≠sico)</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="goal" class="block text-gray-700 font-medium mb-1 md:mb-2">Objetivo</label>
                        <select id="goal" class="w-full p-2 md:p-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-green-400 focus:border-transparent transition-all duration-200">
                            <option value="-0.2">Emagrecer</option>
                            <option value="0">Manter</option>
                            <option value="0.15">Ganhar Massa</option>
                        </select>
                    </div>
                    <div id="protein-percentage-div">
                        <label for="protein-percentage" class="block text-gray-700 font-medium mb-1 md:mb-2">% Prote√≠na (padr√£o: 30%)</label>
                        <input type="number" id="protein-percentage" value="30" min="0" max="100" class="w-full p-2 md:p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-400 focus:border-transparent transition-all duration-200">
                    </div>
                    <div id="carbs-percentage-div">
                        <label for="carbs-percentage" class="block text-gray-700 font-medium mb-1 md:mb-2">% Carboidratos (padr√£o: 45%)</label>
                        <input type="number" id="carbs-percentage" value="45" min="0" max="100" class="w-full p-2 md:p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-400 focus:border-transparent transition-all duration-200">
                    </div>
                    <div id="fat-percentage-div">
                        <label for="fat-percentage" class="block text-gray-700 font-medium mb-1 md:mb-2">% Gordura (padr√£o: 25%)</label>
                        <input type="number" id="fat-percentage" value="25" min="0" max="100" class="w-full p-2 md:p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-400 focus:border-transparent transition-all duration-200">
                    </div>
                    
                    <div class="col-span-1 md:col-span-2 lg:col-span-3 flex justify-center mt-2 md:mt-4">
                        <button type="button" id="calculate-btn" class="bg-green-600 text-white px-6 py-2 md:px-8 md:py-3 rounded-lg font-semibold hover:bg-green-700 transition-all duration-300 transform hover:scale-105 shadow-md" aria-label="Calcular Meu Perfil Nutricional">
                            Calcular Meu Perfil
                        </button>
                    </div>
                </form>
                
                <div id="results" class="mt-8 md:mt-10 p-4 md:p-6 bg-green-50 rounded-xl shadow-inner hidden">
                    <h3 class="text-xl md:text-2xl font-bold mb-4 md:mb-5 text-green-700 border-b pb-2 md:pb-3 border-green-200">Resultados do Perfil Nutricional</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 mb-6 md:mb-8">
                        <div class="bg-white p-4 md:p-5 rounded-lg shadow-sm text-center transform transition-transform hover:scale-105">
                            <h4 class="font-semibold text-gray-700 mb-1 md:mb-2 text-base md:text-lg">Taxa Metab√≥lica Basal (TMB)</h4>
                            <p id="tmb-result" class="text-3xl md:text-4xl font-extrabold text-green-600">0</p>
                            <p class="text-xs md:text-sm text-gray-500">Calorias/dia em repouso</p>
                        </div>
                        
                        <div class="bg-white p-4 md:p-5 rounded-lg shadow-sm text-center transform transition-transform hover:scale-105">
                            <h4 class="font-semibold text-gray-700 mb-1 md:mb-2 text-base md:text-lg">Gasto Cal√≥rico Total (TDEE)</h4>
                            <p id="tdee-result" class="text-3xl md:text-4xl font-extrabold text-green-600">0</p>
                            <p class="text-xs md:text-sm text-gray-500">Calorias/dia considerando atividade</p>
                        </div>
                        
                        <div class="bg-white p-4 md:p-5 rounded-lg shadow-sm text-center transform transition-transform hover:scale-105">
                            <h4 class="font-semibold text-gray-700 mb-1 md:mb-2 text-base md:text-lg">Meta Di√°ria</h4>
                            <p id="goal-result" class="text-3xl md:text-4xl font-extrabold text-green-600">0</p>
                            <p id="goal-text" class="text-xs md:text-sm text-gray-500">Calorias/dia para seu objetivo</p>
                        </div>
                    </div>
                    
                    <h4 class="font-bold text-lg md:text-xl mb-3 md:mb-4 text-green-700 border-b pb-2 md:pb-3 border-green-200">Distribui√ß√£o de Macronutrientes</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 mb-6 md:mb-8">
                        <div class="nutrition-circle bg-red-100 text-red-700">
                            <div class="text-sm md:text-base font-medium">Prote√≠nas</div>
                            <div id="protein-grams" class="text-2xl md:text-3xl font-bold">0g</div>
                            <div id="protein-kcal" class="text-xs md:text-sm">0 kcal</div>
                        </div>
                        
                        <div class="nutrition-circle bg-blue-100 text-blue-700">
                            <div class="text-sm md:text-base font-medium">Carboidratos</div>
                            <div id="carbs-grams" class="text-2xl md:text-3xl font-bold">0g</div>
                            <div id="carbs-kcal" class="text-xs md:text-sm">0 kcal</div>
                        </div>
                        
                        <div class="nutrition-circle bg-yellow-100 text-yellow-700">
                            <div class="text-sm md:text-base font-medium">Gorduras</div>
                            <div id="fat-grams" class="text-2xl md:text-3xl font-bold">0g</div>
                            <div id="fat-kcal" class="text-xs md:text-sm">0 kcal</div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-4 md:p-5 rounded-lg shadow-sm">
                        <h4 class="font-semibold text-gray-700 mb-2 md:mb-3 text-base md:text-lg">Propor√ß√£o de Macronutrientes</h4>
                        <canvas id="macroChart" height="100"></canvas>
                    </div>
                </div>
            </section>

            <!-- Aba Controle Di√°rio -->
            <section id="controle-diario" class="tab-content bg-white rounded-xl shadow-md p-4 md:p-6" role="tabpanel" aria-labelledby="controle-diario-tab">
                <h2 class="text-2xl md:text-3xl font-bold mb-4 md:mb-6 text-green-700 border-b pb-2 md:pb-3 border-green-100">Registro Di√°rio Alimentar</h2>
                
                <div class="mb-6 md:mb-8 bg-green-50 p-3 md:p-4 rounded-lg shadow-sm">
                    <div class="flex flex-col md:flex-row items-center justify-between mb-3 md:mb-4">
                        <div class="mb-2 md:mb-0">
                            <span class="block text-sm text-gray-600">Dia Atual</span>
                            <span id="current-date" class="font-semibold text-base md:text-lg text-green-800">Carregando...</span>
                        </div>
                        <div>
                            <label for="date-input" class="sr-only">Selecionar Data</label>
                            <input type="date" id="date-input" class="p-2 border border-gray-300 rounded-md bg-white text-gray-700 focus:ring-2 focus:ring-green-400 transition-all duration-200">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4 daily-summary-grid">
                        <div class="bg-white p-3 rounded-lg shadow-sm">
                            <div class="text-sm text-green-800 font-medium">Calorias</div>
                            <div class="font-bold text-lg"><span id="current-calories">0</span>/<span id="target-calories">0</span> kcal</div>
                            <div class="progress-bar mt-2">
                                <div id="calories-progress" class="progress-fill bg-green-500"></div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-3 rounded-lg shadow-sm">
                            <div class="text-sm text-red-800 font-medium">Prote√≠nas</div>
                            <div class="font-bold text-lg"><span id="current-protein">0</span>/<span id="target-protein">0</span> g</div>
                            <div class="progress-bar mt-2">
                                <div id="protein-progress" class="progress-fill bg-red-500"></div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-3 rounded-lg shadow-sm">
                            <div class="text-sm text-blue-800 font-medium">Carboidratos</div>
                            <div class="font-bold text-lg"><span id="current-carbs">0</span>/<span id="target-carbs">0</span> g</div>
                            <div class="progress-bar mt-2">
                                <div id="carbs-progress" class="progress-fill bg-blue-500"></div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-3 rounded-lg shadow-sm">
                            <div class="text-sm text-yellow-800 font-medium">Gorduras</div>
                            <div class="font-bold text-lg"><span id="current-fat">0</span>/<span id="target-fat">0</span> g</div>
                            <div class="progress-bar mt-2">
                                <div id="fat-progress" class="progress-fill bg-yellow-500"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <h3 class="text-xl md:text-2xl font-bold mb-3 md:mb-4 text-green-700 border-b pb-1 md:pb-2 border-green-100">Adicionar Refei√ß√£o</h3>
                <form id="add-meal-form" class="mb-6 md:mb-8 p-3 md:p-4 bg-gray-50 rounded-lg shadow-sm">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-3 md:gap-4 mb-3 md:mb-4 add-meal-form-grid">
                        <div>
                            <label for="meal-type" class="block text-gray-700 font-medium mb-1 text-sm">Tipo de Refei√ß√£o</label>
                            <select id="meal-type" class="w-full p-2 border border-gray-300 rounded-md bg-white focus:ring-2 focus:ring-green-400 transition-all duration-200">
                                <option>Caf√© da Manh√£</option>
                                <option>Lanche da Manh√£</option>
                                <option>Almo√ßo</option>
                                <option>Lanche da Tarde</option>
                                <option>Jantar</option>
                                <option>Ceia</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="food-name" class="block text-gray-700 font-medium mb-1 text-sm">Alimento</label>
                            <input type="text" id="food-name" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-400 transition-all duration-200" placeholder="Ex: Frango grelhado">
                        </div>
                        
                        <div>
                            <label for="food-quantity" class="block text-gray-700 font-medium mb-1 text-sm">Quantidade</label>
                            <div class="flex">
                                <input type="number" id="food-quantity" class="w-3/4 p-2 border border-gray-300 rounded-l-md focus:ring-2 focus:ring-green-400 transition-all duration-200" placeholder="100">
                                <select id="quantity-unit" class="w-1/4 p-2 border border-gray-300 rounded-r-md bg-white focus:ring-2 focus:ring-green-400 transition-all duration-200">
                                    <option value="g">g</option>
                                    <option value="ml">ml</option>
                                    <option value="un">un</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="flex flex-col md:flex-row items-end gap-2">
                            <button type="button" id="add-food-btn" class="w-full bg-green-600 text-white px-4 py-2 rounded-md font-semibold hover:bg-green-700 transition-all duration-300 transform hover:scale-105 shadow-md flex items-center justify-center" aria-label="Adicionar Alimento">
                                Adicionar <span id="add-food-loader" class="loader hidden"></span>
                            </button>
                        </div>
                    </div>
                </form>
                
                <h3 class="text-xl md:text-2xl font-bold mb-3 md:mb-4 text-green-700 border-b pb-1 md:pb-2 border-green-100">Refei√ß√µes do Dia</h3>
                <div id="daily-meals" class="mb-6 md:mb-8">
                    <!-- Conte√∫do das refei√ß√µes di√°rias ser√° carregado aqui -->
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                    <div class="bg-gray-50 p-4 md:p-5 rounded-lg shadow-sm">
                        <h4 class="font-semibold text-gray-700 mb-2 md:mb-3 text-base md:text-lg">Distribui√ß√£o por Refei√ß√£o</h4>
                        <canvas id="mealsChart" height="200"></canvas>
                    </div>
                    
                    <div class="bg-gray-50 p-4 md:p-5 rounded-lg shadow-sm">
                        <h4 class="font-semibold text-gray-700 mb-2 md:mb-3 text-base md:text-lg">Distribui√ß√£o de Macronutrientes</h4>
                        <canvas id="dailyMacroChart" height="200"></canvas>
                    </div>
                </div>
            </section>

            <!-- Aba Refei√ß√µes -->
            <section id="refeicoes" class="tab-content bg-white rounded-xl shadow-md p-4 md:p-6" role="tabpanel" aria-labelledby="refeicoes-tab">
                <h2 class="text-2xl md:text-3xl font-bold mb-4 md:mb-6 text-green-700 border-b pb-2 md:pb-3 border-green-100">Planejamento de Refei√ß√µes</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-6 md:mb-8">
                    <div class="bg-green-50 p-4 md:p-5 rounded-lg shadow-sm">
                        <h3 class="text-xl font-bold mb-3 md:mb-4 text-green-700">Criar Nova Refei√ß√£o (Template)</h3>
                        <form id="meal-template-form" class="space-y-3 md:space-y-4 meal-template-form-grid">
                            <div>
                                <label for="meal-type-template" class="block text-gray-700 font-medium mb-1 text-sm">Tipo de Refei√ß√£o</label>
                                <select id="meal-type-template" class="w-full p-2 border border-gray-300 rounded-md bg-white focus:ring-2 focus:ring-green-400 transition-all duration-200">
                                    <option value="Caf√© da Manh√£">Caf√© da Manh√£</option>
                                    <option value="Lanche da Manh√£">Lanche da Manh√£</option>
                                    <option value="Almo√ßo">Almo√ßo</option>
                                    <option value="Lanche da Tarde">Lanche da Tarde</option>
                                    <option value="Jantar">Jantar</option>
                                    <option value="Ceia">Ceia</option>
                                </select>
                            </div>
                            
                            <div>
                                <label for="meal-name-template" class="block text-gray-700 font-medium mb-1 text-sm">Nome da Refei√ß√£o</label>
                                <input type="text" id="meal-name-template" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-400 transition-all duration-200" placeholder="Ex: Omelete com vegetais">
                            </div>
                            
                            <button type="button" id="add-meal-template-btn" class="w-full bg-green-600 text-white px-4 py-2 rounded-md font-semibold hover:bg-green-700 transition-all duration-300 transform hover:scale-105 shadow-md" aria-label="Criar Template de Refei√ß√£o">
                                Criar Template de Refei√ß√£o
                            </button>
                        </form>
                    </div>
                    
                    <div>
                        <h3 class="text-xl font-bold mb-3 md:mb-4 text-green-700">Meus Templates de Refei√ß√£o</h3>
                        <div id="meal-cards" class="grid grid-cols-1 gap-4">
                            <div class="border border-dashed border-gray-300 rounded-lg p-6 md:p-8 text-center text-gray-500">
                                <p>Nenhum template de refei√ß√£o criado ainda.</p>
                                <p class="text-sm mt-2">Use o formul√°rio ao lado para come√ßar!</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gray-50 p-4 md:p-5 rounded-lg shadow-sm">
                    <h3 class="font-semibold text-gray-700 mb-2 md:mb-3 text-base md:text-lg">Distribui√ß√£o de Calorias por Refei√ß√£o (Hist√≥rico)</h3>
                    <canvas id="mealDistributionChart" height="150"></canvas>
                </div>
            </section>

            <!-- Aba Evolu√ß√£o -->
            <section id="evolucao" class="tab-content bg-white rounded-xl shadow-md p-4 md:p-6" role="tabpanel" aria-labelledby="evolucao-tab">
                <h2 class="text-2xl md:text-3xl font-bold mb-4 md:mb-6 text-green-700 border-b pb-2 md:pb-3 border-green-100">Evolu√ß√£o de Peso e Medidas</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-6 md:mb-8">
                    <div class="bg-green-50 p-4 md:p-5 rounded-lg shadow-sm">
                        <h3 class="text-xl font-bold mb-3 md:mb-4 text-green-700">Registrar Novas Medidas</h3>
                        <form id="measurements-form" class="space-y-3 md:space-y-4 measurements-form-grid">
                            <div>
                                <label for="measurement-date" class="block text-gray-700 font-medium mb-1 text-sm">Data</label>
                                <input type="date" id="measurement-date" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-400 transition-all duration-200">
                            </div>
                            
                            <div>
                                <label for="measurement-weight" class="block text-gray-700 font-medium mb-1 text-sm">Peso (kg)</label>
                                <input type="number" step="0.1" id="measurement-weight" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-400 transition-all duration-200" placeholder="Ex: 70.0">
                            </div>
                            
                            <div>
                                <label for="measurement-waist" class="block text-gray-700 font-medium mb-1 text-sm">Cintura (cm)</label>
                                <input type="number" step="0.1" id="measurement-waist" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-400 transition-all duration-200" placeholder="Ex: 80.0">
                            </div>
                            
                            <div>
                                <label for="measurement-abdomen" class="block text-gray-700 font-medium mb-1 text-sm">Abd√¥men (cm)</label>
                                <input type="number" step="0.1" id="measurement-abdomen" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-400 transition-all duration-200" placeholder="Ex: 85.0">
                            </div>
                            
                            <div>
                                <label for="measurement-hip" class="block text-gray-700 font-medium mb-1 text-sm">Quadril (cm)</label>
                                <input type="number" step="0.1" id="measurement-hip" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-400 transition-all duration-200" placeholder="Ex: 95.0">
                            </div>
                            
                            <div>
                                <label for="measurement-arm" class="block text-gray-700 font-medium mb-1 text-sm">Bra√ßo (cm)</label>
                                <input type="number" step="0.1" id="measurement-arm" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-400 transition-all duration-200" placeholder="Ex: 30.0">
                            </div>
                            
                            <div>
                                <label for="measurement-thigh" class="block text-gray-700 font-medium mb-1 text-sm">Coxa (cm)</label>
                                <input type="number" step="0.1" id="measurement-thigh" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-400 transition-all duration-200" placeholder="Ex: 50.0">
                            </div>
                            
                            <div>
                                <label for="measurement-chest" class="block text-gray-700 font-medium mb-1 text-sm">Peitoral (cm - opcional)</label>
                                <input type="number" step="0.1" id="measurement-chest" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-400 transition-all duration-200" placeholder="Ex: 90.0">
                            </div>
                            
                            <div class="col-span-full">
                                <button type="button" id="save-measurement-btn" class="w-full bg-green-600 text-white px-4 py-2 rounded-md font-semibold hover:bg-green-700 transition-all duration-300 transform hover:scale-105 shadow-md" aria-label="Registrar Medidas">
                                    Registrar Medidas
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="bg-gray-50 p-4 md:p-5 rounded-lg shadow-sm">
                        <h3 class="text-xl font-bold mb-3 md:mb-4 text-green-700">Evolu√ß√£o do Peso</h3>
                        <canvas id="weightChart" height="250"></canvas>
                    </div>
                </div>
                
                <h3 class="text-xl md:text-2xl font-bold mb-3 md:mb-4 text-green-700 border-b pb-1 md:pb-2 border-green-100">Hist√≥rico de Medi√ß√µes</h3>
                <div class="overflow-x-auto mb-6 md:mb-8 rounded-lg border border-gray-200 shadow-sm">
                    <table class="w-full min-w-[700px] bg-white responsive-table">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="p-3 border-b text-left text-sm font-semibold text-gray-600">Data</th>
                                <th class="p-3 border-b text-left text-sm font-semibold text-gray-600">Peso (kg)</th>
                                <th class="p-3 border-b text-left text-sm font-semibold text-gray-600">Cintura (cm)</th>
                                <th class="p-3 border-b text-left text-sm font-semibold text-gray-600">Abd√¥men (cm)</th>
                                <th class="p-3 border-b text-left text-sm font-semibold text-gray-600">Quadril (cm)</th>
                                <th class="p-3 border-b text-left text-sm font-semibold text-gray-600">Bra√ßo (cm)</th>
                                <th class="p-3 border-b text-left text-sm font-semibold text-gray-600">Coxa (cm)</th>
                                <th class="p-3 border-b text-left text-sm font-semibold text-gray-600">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="measurements-history">
                            <tr>
                                <td colspan="8" class="p-4 text-center text-gray-500">Nenhuma medi√ß√£o registrada</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
                    <div class="bg-gray-50 p-4 md:p-5 rounded-lg shadow-sm">
                        <h4 class="font-semibold text-gray-700 mb-2 md:mb-3 text-base md:text-lg">Evolu√ß√£o da Cintura</h4>
                        <canvas id="waistChart" height="200"></canvas>
                    </div>
                    
                    <div class="bg-gray-50 p-4 md:p-5 rounded-lg shadow-sm">
                        <h4 class="font-semibold text-gray-700 mb-2 md:mb-3 text-base md:text-lg">Evolu√ß√£o do Abd√¥men</h4>
                        <canvas id="abdomenChart" height="200"></canvas>
                    </div>
                    
                    <div class="bg-gray-50 p-4 md:p-5 rounded-lg shadow-sm">
                        <h4 class="font-semibold text-gray-700 mb-2 md:mb-3 text-base md:text-lg">Evolu√ß√£o do Quadril</h4>
                        <canvas id="hipChart" height="200"></canvas>
                    </div>
                </div>
            </section>

            <!-- Aba Di√°rio -->
            <section id="diario" class="tab-content bg-white rounded-xl shadow-md p-4 md:p-6" role="tabpanel" aria-labelledby="diario-tab">
                <h2 class="text-2xl md:text-3xl font-bold mb-4 md:mb-6 text-green-700 border-b pb-2 md:pb-3 border-green-100">Di√°rio de Consist√™ncia e Reflex√£o</h2>
                
                <div class="mb-4 md:mb-6 p-3 md:p-4 bg-gray-50 rounded-lg shadow-sm">
                    <label for="journal-date" class="block text-gray-700 font-medium mb-1 text-sm">Data do Registro</label>
                    <input type="date" id="journal-date" class="w-full p-2 border border-gray-300 rounded-md max-w-xs focus:ring-2 focus:ring-green-400 transition-all duration-200">
                </div>
                
                <div class="mb-4 md:mb-6">
                    <label for="journal-good" class="block text-gray-700 font-medium mb-1 md:mb-2">O que fiz bem essa semana?</label>
                    <textarea id="journal-good" class="w-full p-2 md:p-3 border border-gray-300 rounded-lg h-24 md:h-28 resize-y focus:ring-2 focus:ring-green-400 transition-all duration-200 journal-textarea" placeholder="Ex: Consegui seguir meu plano alimentar todos os dias, treinei 5x na semana."></textarea>
                </div>
                
                <div class="mb-4 md:mb-6">
                    <label for="journal-improve" class="block text-gray-700 font-medium mb-1 md:mb-2">O que posso melhorar?</label>
                    <textarea id="journal-improve" class="w-full p-2 md:p-3 border border-gray-300 rounded-lg h-24 md:h-28 resize-y focus:ring-2 focus:ring-green-400 transition-all duration-200 journal-textarea" placeholder="Ex: Preciso beber mais √°gua, evitar lanches noturnos."></textarea>
                </div>
                
                <div class="mb-4 md:mb-6">
                    <label for="journal-focus" class="block text-gray-700 font-medium mb-1 md:mb-2">Qual ser√° meu foco para a pr√≥xima semana?</label>
                    <textarea id="journal-focus" class="w-full p-2 md:p-3 border border-gray-300 rounded-lg h-24 md:h-28 resize-y focus:ring-2 focus:ring-green-400 transition-all duration-200 journal-textarea" placeholder="Ex: Focar em hidrata√ß√£o e incluir mais vegetais nas refei√ß√µes."></textarea>
                </div>
                
                <div class="mb-4 md:mb-6">
                    <label for="journal-rating" class="block text-gray-700 font-medium mb-1 md:mb-2">Nota pessoal de consist√™ncia (0 a 10)</label>
                    <input type="number" id="journal-rating" min="0" max="10" class="w-20 p-2 md:p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-400 transition-all duration-200" placeholder="Ex: 8">
                </div>
                
                <div class="mb-6 md:mb-8">
                    <label for="journal-notes" class="block text-gray-700 font-medium mb-1 md:mb-2">Coment√°rios adicionais</label>
                    <textarea id="journal-notes" class="w-full p-2 md:p-3 border border-gray-300 rounded-lg h-32 md:h-36 resize-y focus:ring-2 focus:ring-green-400 transition-all duration-200 journal-textarea" placeholder="Qualquer outra observa√ß√£o sobre sua semana."></textarea>
                </div>
                
                <button id="save-journal-btn" class="bg-green-600 text-white px-6 py-2 md:px-6 md:py-3 rounded-lg font-semibold hover:bg-green-700 transition-all duration-300 transform hover:scale-105 shadow-md" aria-label="Salvar Registro do Di√°rio">
                    Salvar Registro do Di√°rio
                </button>
            </section>

            <!-- Aba Feedback -->
            <section id="feedback" class="tab-content bg-white rounded-xl shadow-md p-4 md:p-6" role="tabpanel" aria-labelledby="feedback-tab">
                <h2 class="text-2xl md:text-3xl font-bold mb-4 md:mb-6 text-green-700 border-b pb-2 md:pb-3 border-green-100">Avalie sua Experi√™ncia</h2>
                
                <div class="mb-4 md:mb-6 bg-gray-50 p-4 md:p-5 rounded-lg shadow-sm text-center">
                    <label class="block text-gray-700 font-bold mb-2 md:mb-3 text-base md:text-lg">Classifique sua experi√™ncia com o aplicativo:</label>
                    <div class="flex justify-center space-x-2">
                        <button class="star-btn text-3xl md:text-4xl text-gray-300" data-rating="1" aria-label="1 estrela">‚≠ê</button>
                        <button class="star-btn text-3xl md:text-4xl text-gray-300" data-rating="2" aria-label="2 estrelas">‚≠ê</button>
                        <button class="star-btn text-3xl md:text-4xl text-gray-300" data-rating="3" aria-label="3 estrelas">‚≠ê</button>
                        <button class="star-btn text-3xl md:text-4xl text-gray-300" data-rating="4" aria-label="4 estrelas">‚≠ê</button>
                        <button class="star-btn text-3xl md:text-4xl text-gray-300" data-rating="5" aria-label="5 estrelas">‚≠ê</button>
                    </div>
                    <div id="rating-text" class="text-sm text-gray-600 mt-1 md:mt-2 font-medium">0/5 estrelas</div>
                </div>
                
                <div class="mb-4 md:mb-6">
                    <label for="feedback-positive" class="block text-gray-700 font-medium mb-1 md:mb-2">O que voc√™ mais gostou no aplicativo?</label>
                    <textarea id="feedback-positive" class="w-full p-2 md:p-3 border border-gray-300 rounded-lg h-24 md:h-28 resize-y focus:ring-2 focus:ring-green-400 transition-all duration-200" placeholder="Ex: A facilidade de uso, o acompanhamento de macros, os gr√°ficos."></textarea>
                </div>
                
                <div class="mb-4 md:mb-6">
                    <label for="feedback-improve" class="block text-gray-700 font-medium mb-1 md:mb-2">O que podemos melhorar?</label>
                    <textarea id="feedback-improve" class="w-full p-2 md:p-3 border border-gray-300 rounded-lg h-24 md:h-28 resize-y focus:ring-2 focus:ring-green-400 transition-all duration-200" placeholder="Ex: Adicionar mais alimentos ao banco de dados, melhorar a interface em telas pequenas."></textarea>
                </div>
                
                <div class="mb-6 md:mb-8">
                    <label for="feedback-comments" class="block text-gray-700 font-medium mb-1 md:mb-2">Coment√°rios adicionais (opcional)</label>
                    <textarea id="feedback-comments" class="w-full p-2 md:p-3 border border-gray-300 rounded-lg h-32 md:h-36 resize-y focus:ring-2 focus:ring-green-400 transition-all duration-200" placeholder="Qualquer outra sugest√£o ou observa√ß√£o."></textarea>
                </div>
                
                <button id="save-feedback-btn" class="bg-green-600 text-white px-6 py-2 md:px-6 md:py-3 rounded-lg font-semibold hover:bg-green-700 transition-all duration-300 transform hover:scale-105 shadow-md" aria-label="Enviar Feedback">
                    Enviar Feedback
                </button>
            </section>
        </main>
    </div>

    <script>
        // Registrar o plugin datalabels globalmente
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof Chart !== 'undefined' && typeof ChartDataLabels !== 'undefined') {
                Chart.register(ChartDataLabels);
            } else {
                console.warn("Chart.js or ChartDataLabels not loaded yet. Retrying registration...");
                setTimeout(() => {
                    if (typeof Chart !== 'undefined' && typeof ChartDataLabels !== 'undefined') {
                        Chart.register(ChartDataLabels);
                    } else {
                        console.error("Failed to register ChartDataLabels. Charts might not display labels correctly.");
                    }
                }, 1000);
            }
        });

        // --- Vari√°veis Globais para Armazenar Dados e Refer√™ncias DOM ---
        let userData = {
            tmb: 0,
            tdee: 0,
            dailyCalories: 0,
            proteinPercent: 30,
            carbsPercent: 45,
            fatPercent: 25,
        };

        let measurements = [];
        let meals = {}; 
        let mealTemplates = {}; 
        let journalEntries = [];
        let feedbackData = [];
        let currentRating = 0;

        // Refer√™ncias DOM (cached for performance)
        const DOM = {
            // Tabs
            tabButtons: document.querySelectorAll('.tab-btn'),
            tabContents: document.querySelectorAll('.tab-content'),

            // Personal Data Tab
            personalDataForm: document.getElementById('personal-data-form'),
            calculateBtn: document.getElementById('calculate-btn'),
            resultsDiv: document.getElementById('results'),
            tmbResult: document.getElementById('tmb-result'),
            tdeeResult: document.getElementById('tdee-result'),
            goalResult: document.getElementById('goal-result'),
            goalText: document.getElementById('goal-text'),
            proteinGrams: document.getElementById('protein-grams'),
            proteinKcal: document.getElementById('protein-kcal'),
            carbsGrams: document.getElementById('carbs-grams'),
            carbsKcal: document.getElementById('carbs-kcal'),
            fatGrams: document.getElementById('fat-grams'),
            fatKcal: document.getElementById('fat-kcal'),
            macroChartCanvas: document.getElementById('macroChart'),

            // Daily Control Tab
            currentDateSpan: document.getElementById('current-date'),
            dateInput: document.getElementById('date-input'),
            currentCalories: document.getElementById('current-calories'),
            targetCalories: document.getElementById('target-calories'),
            caloriesProgress: document.getElementById('calories-progress'),
            currentProtein: document.getElementById('current-protein'),
            targetProtein: document.getElementById('target-protein'),
            proteinProgress: document.getElementById('protein-progress'),
            currentCarbs: document.getElementById('current-carbs'),
            targetCarbs: document.getElementById('target-carbs'),
            carbsProgress: document.getElementById('carbs-progress'),
            currentFat: document.getElementById('current-fat'),
            targetFat: document.getElementById('target-fat'),
            fatProgress: document.getElementById('fat-progress'),
            addMealForm: document.getElementById('add-meal-form'),
            addFoodBtn: document.getElementById('add-food-btn'),
            addFoodLoader: document.getElementById('add-food-loader'),
            dailyMealsDiv: document.getElementById('daily-meals'),
            mealsChartCanvas: document.getElementById('mealsChart'),
            dailyMacroChartCanvas: document.getElementById('dailyMacroChart'),

            // Meal Planning Tab
            addMealTemplateBtn: document.getElementById('add-meal-template-btn'),
            mealCardsContainer: document.getElementById('meal-cards'),
            mealDistributionChartCanvas: document.getElementById('mealDistributionChart'),

            // Evolution Tab
            measurementsForm: document.getElementById('measurements-form'),
            saveMeasurementBtn: document.getElementById('save-measurement-btn'),
            measurementsHistoryTable: document.getElementById('measurements-history'),
            weightChartCanvas: document.getElementById('weightChart'),
            waistChartCanvas: document.getElementById('waistChart'),
            abdomenChartCanvas: document.getElementById('abdomenChart'),
            hipChartCanvas: document.getElementById('hipChart'),

            // Journal Tab
            journalDateInput: document.getElementById('journal-date'),
            saveJournalBtn: document.getElementById('save-journal-btn'),

            // Feedback Tab
            starButtons: document.querySelectorAll('.star-btn'),
            ratingText: document.getElementById('rating-text'),
            saveFeedbackBtn: document.getElementById('save-feedback-btn'),
        };

        // --- Fun√ß√µes de Utilidade ---
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `fixed bottom-4 right-4 p-3 rounded-lg shadow-lg text-white z-50 ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // --- Fun√ß√µes de Persist√™ncia de Dados (localStorage) ---
        function saveAllData() {
            try {
                localStorage.setItem('userData', JSON.stringify(userData));
                localStorage.setItem('measurements', JSON.stringify(measurements));
                localStorage.setItem('meals', JSON.stringify(meals));
                localStorage.setItem('mealTemplates', JSON.stringify(mealTemplates));
                localStorage.setItem('journalEntries', JSON.stringify(journalEntries));
                localStorage.setItem('feedbackData', JSON.stringify(feedbackData));
                // console.log("Dados salvos no localStorage."); // Para depura√ß√£o
            } catch (e) {
                console.error("Erro ao salvar dados no localStorage:", e);
                showToast("Erro ao salvar dados. Seu navegador pode estar em modo de navega√ß√£o privada ou o armazenamento est√° cheio.", 'error');
            }
        }

        function loadAllData() {
            try {
                const storedUserData = localStorage.getItem('userData');
                if (storedUserData) userData = { ...userData, ...JSON.parse(storedUserData) }; 

                const storedMeasurements = localStorage.getItem('measurements');
                if (storedMeasurements) measurements = JSON.parse(storedMeasurements);

                const storedMeals = localStorage.getItem('meals');
                if (storedMeals) meals = JSON.parse(storedMeals);

                const storedMealTemplates = localStorage.getItem('mealTemplates');
                if (storedMealTemplates) mealTemplates = JSON.parse(storedMealTemplates);

                const storedJournalEntries = localStorage.getItem('journalEntries');
                if (storedJournalEntries) journalEntries = JSON.parse(storedJournalEntries);

                const storedFeedbackData = localStorage.getItem('feedbackData');
                if (storedFeedbackData) feedbackData = JSON.parse(storedFeedbackData);

                // console.log("Dados carregados do localStorage."); // Para depura√ß√£o
            } catch (e) {
                console.error("Erro ao carregar dados do localStorage:", e);
                showToast("Erro ao carregar dados. Alguns dados podem n√£o ter sido recuperados.", 'error');
            }
        }

        // --- Gerenciamento de Abas ---
        function activateTab(tabId) {
            DOM.tabButtons.forEach(btn => {
                btn.classList.remove('bg-green-100', 'text-green-700', 'font-semibold');
                btn.classList.add('text-gray-700', 'hover:bg-green-50', 'hover:text-green-600', 'font-medium');
                btn.setAttribute('aria-selected', 'false');
            });
            const activeButton = document.querySelector(`.tab-btn[data-tab="${tabId}"]`);
            if (activeButton) {
                activeButton.classList.remove('text-gray-700', 'hover:bg-green-50', 'hover:text-green-600', 'font-medium');
                activeButton.classList.add('bg-green-100', 'text-green-700', 'font-semibold');
                activeButton.setAttribute('aria-selected', 'true');
            }

            DOM.tabContents.forEach(content => {
                content.classList.remove('active');
                content.setAttribute('aria-hidden', 'true');
            });
            const activeContent = document.getElementById(tabId);
            if (activeContent) {
                activeContent.classList.add('active');
                activeContent.setAttribute('aria-hidden', 'false');
            }
            
            // Atualizar gr√°ficos e dados ao mudar de aba
            if (tabId === 'controle-diario') {
                loadDayMeals(DOM.dateInput.value); 
            } else if (tabId === 'evolucao') {
                updateMeasurementCharts();
            } else if (tabId === 'refeicoes') {
                updateMealCards();
                updateMealDistributionChart(); 
            } else if (tabId === 'feedback') {
                updateStarRatingDisplay();
            }
        }

        DOM.tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                activateTab(button.getAttribute('data-tab'));
            });
        });

        // --- Aba Dados Pessoais ---
        function updateCurrentDateDisplay() {
            const today = new Date();
            const dateString = today.toLocaleDateString('pt-BR', { weekday: 'long', day: 'numeric', month: 'long' });
            DOM.currentDateSpan.textContent = dateString.charAt(0).toUpperCase() + dateString.slice(1);
            
            const isoDate = today.toISOString().split('T')[0];
            DOM.dateInput.value = isoDate;
            DOM.journalDateInput.value = isoDate;
            DOM.measurementsForm.querySelector('#measurement-date').value = isoDate;
        }

        DOM.calculateBtn.addEventListener('click', () => {
            const gender = document.getElementById('gender').value;
            const age = parseInt(document.getElementById('age').value);
            const height = parseInt(document.getElementById('height').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const activity = parseFloat(document.getElementById('activity').value);
            const goal = parseFloat(document.getElementById('goal').value);
            
            userData.proteinPercent = parseInt(document.getElementById('protein-percentage').value) || 0;
            userData.carbsPercent = parseInt(document.getElementById('carbs-percentage').value) || 0;
            userData.fatPercent = parseInt(document.getElementById('fat-percentage').value) || 0;

            // Armazenar input do usu√°rio para persist√™ncia
            userData.gender = gender;
            userData.age = age;
            userData.height = height;
            userData.weight = weight;
            userData.activity = activity;
            userData.goal = goal;
            
            if (!age || !height || !weight || isNaN(age) || isNaN(height) || isNaN(weight) || age <= 0 || height <= 0 || weight <= 0) {
                showToast('Por favor, preencha Idade, Altura e Peso com valores num√©ricos positivos v√°lidos.', 'error');
                return;
            }
            
            if ((userData.proteinPercent + userData.carbsPercent + userData.fatPercent) !== 100) {
                showToast('A soma das porcentagens de Prote√≠na, Carboidratos e Gordura deve ser 100%. Por favor, ajuste.', 'error');
                return;
            }

            // C√°lculo da TMB (Mifflin-St Jeor)
            // \$TMB = (10 \times peso) + (6.25 \times altura) - (5 \times idade) + 5\$ (para homens)
            // \$TMB = (10 \times peso) + (6.25 \times altura) - (5 \times idade) - 161\$ (para mulheres)
            if (gender === 'M') {
                userData.tmb = (10 * weight) + (6.25 * height) - (5 * age) + 5;
            } else {
                userData.tmb = (10 * weight) + (6.25 * height) - (5 * age) - 161;
            }
            
            // \$TDEE = TMB \times Fator\_Atividade\$
            // \$Meta\_Di√°ria = TDEE + (TDEE \times Objetivo)\$
            userData.tdee = userData.tmb * activity;
            userData.dailyCalories = Math.round(userData.tdee + (userData.tdee * goal));
            
            DOM.tmbResult.textContent = Math.round(userData.tmb);
            DOM.tdeeResult.textContent = Math.round(userData.tdee);
            DOM.goalResult.textContent = userData.dailyCalories;
            
            let goalText = '';
            if (goal < 0) {
                goalText = 'D√©ficit cal√≥rico para emagrecimento';
            } else if (goal > 0) {
                goalText = 'Super√°vit cal√≥rico para ganho de massa';
            } else {
                goalText = 'Manuten√ß√£o cal√≥rica';
            }
            DOM.goalText.textContent = goalText;
            
            calculateAndDisplayMacros();
            updateMacroChart();
            DOM.resultsDiv.classList.remove('hidden');
            
            DOM.targetCalories.textContent = userData.dailyCalories;
            DOM.targetProtein.textContent = Math.round((userData.dailyCalories * userData.proteinPercent / 100) / 4);
            DOM.targetCarbs.textContent = Math.round((userData.dailyCalories * userData.carbsPercent / 100) / 4);
            DOM.targetFat.textContent = Math.round((userData.dailyCalories * userData.fatPercent / 100) / 9);

            loadDayMeals(DOM.dateInput.value);
            saveAllData();
            showToast('Perfil nutricional e objetivos salvos!', 'success');
        });

        function calculateAndDisplayMacros() {
            // \$1g Prote√≠na = 4 kcal\$
            // \$1g Carboidrato = 4 kcal\$
            // \$1g Gordura = 9 kcal\$
            const proteinKcal = Math.round(userData.dailyCalories * userData.proteinPercent / 100);
            const proteinGrams = Math.round(proteinKcal / 4);
            
            const carbsKcal = Math.round(userData.dailyCalories * userData.carbsPercent / 100);
            const carbsGrams = Math.round(carbsKcal / 4);
            
            const fatKcal = Math.round(userData.dailyCalories * userData.fatPercent / 100);
            const fatGrams = Math.round(fatKcal / 9);
            
            DOM.proteinKcal.textContent = proteinKcal + ' kcal';
            DOM.proteinGrams.textContent = proteinGrams + 'g';
            
            DOM.carbsKcal.textContent = carbsKcal + ' kcal';
            DOM.carbsGrams.textContent = carbsGrams + 'g';
            
            DOM.fatKcal.textContent = fatKcal + ' kcal';
            DOM.fatGrams.textContent = fatGrams + 'g';
        }

        let macroChartInstance;
        function updateMacroChart() {
            if (macroChartInstance) {
                macroChartInstance.destroy();
            }
            
            macroChartInstance = new Chart(DOM.macroChartCanvas, {
                type: 'pie',
                data: {
                    labels: ['Prote√≠nas', 'Carboidratos', 'Gorduras'],
                    datasets: [{
                        data: [
                            userData.dailyCalories * userData.proteinPercent / 100,
                            userData.dailyCalories * userData.carbsPercent / 100,
                            userData.dailyCalories * userData.fatPercent / 100
                        ],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.8)', // Vermelho para Prote√≠na
                            'rgba(54, 162, 235, 0.8)', // Azul para Carboidratos
                            'rgba(255, 206, 86, 0.8)' // Amarelo para Gorduras
                        ],
                        borderColor: '#ffffff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                font: {
                                    size: 14
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const percentage = userData.dailyCalories > 0 ? ((value / userData.dailyCalories) * 100).toFixed(1) : 0;
                                    return `${label}: ${Math.round(value)} kcal (${percentage}%)`;
                                }
                            }
                        },
                        datalabels: {
                            color: '#fff',
                            formatter: (value, ctx) => {
                                const percentage = userData.dailyCalories > 0 ? ((value / userData.dailyCalories) * 100).toFixed(0) : 0;
                                return percentage > 5 ? `${percentage}%` : ''; // Mostrar apenas se a porcentagem for significativa
                            },
                            font: {
                                weight: 'bold',
                                size: 12
                            }
                        }
                    }
                },
                plugins: [ChartDataLabels]
            });
        }

        // --- Aba Controle Di√°rio ---
        let mealsChartInstance, dailyMacroChartInstance;
        function updateDailyCharts() {
            const mealTypes = ['Caf√© da Manh√£', 'Lanche da Manh√£', 'Almo√ßo', 'Lanche da Tarde', 'Jantar', 'Ceia'];
            const currentDate = DOM.dateInput.value;
            const dailyMealsForDate = meals[currentDate] || [];
            
            let totalCalories = 0;
            let totalProtein = 0;
            let totalCarbs = 0;
            let totalFat = 0;

            dailyMealsForDate.forEach(meal => {
                totalCalories += meal.calories || 0;
                totalProtein += meal.protein || 0;
                totalCarbs += meal.carbs || 0;
                totalFat += meal.fat || 0;
            });

            const mealCaloriesByType = mealTypes.map(type => {
                return dailyMealsForDate
                    .filter(meal => meal.type === type)
                    .reduce((sum, meal) => sum + (meal.calories || 0), 0);
            });
            
            DOM.currentCalories.textContent = Math.round(totalCalories);
            DOM.currentProtein.textContent = Math.round(totalProtein);
            DOM.currentCarbs.textContent = Math.round(totalCarbs);
            DOM.currentFat.textContent = Math.round(totalFat);
            
            const targetCalories = parseInt(DOM.targetCalories.textContent) || 1;
            const caloriesProgress = (targetCalories > 0) ? (totalCalories / targetCalories) * 100 : 0;
            animateProgressBar(DOM.caloriesProgress, caloriesProgress);
            
            const targetProtein = parseInt(DOM.targetProtein.textContent) || 1;
            const proteinProgress = (targetProtein > 0) ? (totalProtein / targetProtein) * 100 : 0;
            animateProgressBar(DOM.proteinProgress, proteinProgress);
            
            const targetCarbs = parseInt(DOM.targetCarbs.textContent) || 1;
            const carbsProgress = (targetCarbs > 0) ? (totalCarbs / targetCarbs) * 100 : 0;
            animateProgressBar(DOM.carbsProgress, carbsProgress);
            
            const targetFat = parseInt(DOM.targetFat.textContent) || 1;
            const fatProgress = (targetFat > 0) ? (totalFat / targetFat) * 100 : 0; 
            animateProgressBar(DOM.fatProgress, fatProgress);
            
            if (mealsChartInstance) mealsChartInstance.destroy();
            if (dailyMacroChartInstance) dailyMacroChartInstance.destroy();
            
            mealsChartInstance = new Chart(DOM.mealsChartCanvas, {
                type: 'bar',
                data: {
                    labels: mealTypes,
                    datasets: [{
                        label: 'Calorias por Refei√ß√£o',
                        data: mealCaloriesByType.map(c => Math.round(c)),
                        backgroundColor: [
                            'rgba(76, 175, 80, 0.7)', // Verde
                            'rgba(33, 150, 243, 0.7)', // Azul
                            'rgba(255, 193, 7, 0.7)', // √Çmbar
                            'rgba(139, 195, 74, 0.7)', // Verde Claro
                            'rgba(0, 188, 212, 0.7)', // Ciano
                            'rgba(255, 87, 34, 0.7)'  // Laranja Escuro
                        ],
                        borderColor: [
                            'rgba(76, 175, 80, 1)',
                            'rgba(33, 150, 243, 1)',
                            'rgba(255, 193, 7, 1)',
                            'rgba(139, 195, 74, 1)',
                            'rgba(0, 188, 212, 1)',
                            'rgba(255, 87, 34, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        title: { display: true, text: 'Distribui√ß√£o de Calorias por Refei√ß√£o' },
                        datalabels: {
                            anchor: 'end',
                            align: 'top',
                            formatter: (value) => value > 0 ? `${value} kcal` : '',
                            color: '#4A5568', 
                            font: {
                                weight: 'bold',
                                size: 10
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Calorias (kcal)' }
                        },
                        x: {
                            title: { display: true, text: 'Tipo de Refei√ß√£o' }
                        }
                    }
                },
                plugins: [ChartDataLabels]
            });
            
            dailyMacroChartInstance = new Chart(DOM.dailyMacroChartCanvas, {
                type: 'doughnut',
                data: {
                    labels: ['Prote√≠nas', 'Carboidratos', 'Gorduras'],
                    datasets: [{
                        data: [totalProtein * 4, totalCarbs * 4, totalFat * 9],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.8)', // Vermelho para Prote√≠na
                            'rgba(54, 162, 235, 0.8)', // Azul para Carboidratos
                            'rgba(255, 206, 86, 0.8)'  // Amarelo para Gorduras
                        ],
                        borderColor: '#ffffff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                font: {
                                    size: 14
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    let value = context.raw || 0;
                                    let text = `${label}: ${Math.round(value)} kcal`;
                                    
                                    if (label === 'Prote√≠nas') {
                                        text += ` (${Math.round(value / 4)}g)`;
                                    } else if (label === 'Carboidratos') {
                                        text += ` (${Math.round(value / 4)}g)`;
                                    } else if (label === 'Gorduras') {
                                        text += ` (${Math.round(value / 9)}g)`;
                                    }
                                    return text;
                                }
                            }
                        },
                        datalabels: {
                            color: '#fff',
                            formatter: (value, ctx) => {
                                const total = ctx.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = total > 0 ? ((value / total) * 100).toFixed(0) : 0;
                                return percentage > 5 ? `${percentage}%` : '';
                            },
                            font: {
                                weight: 'bold',
                                size: 12
                            }
                        }
                    }
                },
                plugins: [ChartDataLabels]
            });
        }

        function loadDayMeals(date) {
            const mealsForDate = meals[date] || [];
            
            if (mealsForDate.length === 0) {
                DOM.dailyMealsDiv.innerHTML = `
                    <div class="text-center py-6 md:py-8 text-gray-500 bg-gray-50 rounded-lg shadow-sm">
                        <p class="text-base md:text-lg font-medium">Nenhuma refei√ß√£o adicionada nesta data.</p>
                        <p class="text-sm mt-2">Adicione alimentos para come√ßar o acompanhamento di√°rio!</p>
                    </div>
                `;
                DOM.currentCalories.textContent = 0;
                DOM.currentProtein.textContent = 0;
                DOM.currentCarbs.textContent = 0;
                DOM.currentFat.textContent = 0;
                animateProgressBar(DOM.caloriesProgress, 0);
                animateProgressBar(DOM.proteinProgress, 0);
                animateProgressBar(DOM.carbsProgress, 0);
                animateProgressBar(DOM.fatProgress, 0);
                updateDailyCharts();
                return;
            }
            
            let html = '';
            const groupedMeals = {};
            const orderedMealTypes = ['Caf√© da Manh√£', 'Lanche da Manh√£', 'Almo√ßo', 'Lanche da Tarde', 'Jantar', 'Ceia'];
            orderedMealTypes.forEach(type => {
                groupedMeals[type] = mealsForDate.filter(meal => meal.type === type);
            });

            for (const type of orderedMealTypes) {
                const mealList = groupedMeals[type];
                if (mealList.length === 0) continue;

                let typeTotalCalories = 0;
                let typeTotalProtein = 0;
                let typeTotalCarbs = 0;
                let typeTotalFat = 0;
                
                html += `<div class="mb-4 md:mb-6 p-3 md:p-4 bg-gray-50 rounded-lg shadow-sm">
                    <h4 class="text-lg md:text-xl font-bold text-green-700 mb-2 md:mb-3">${type}</h4>
                    <div class="overflow-x-auto rounded-lg border border-gray-200">
                        <table class="min-w-full bg-white responsive-table">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="py-2 px-3 border-b text-left text-sm font-semibold text-gray-600">Alimento</th>
                                    <th class="py-2 px-3 border-b text-left text-sm font-semibold text-gray-600">Qtd</th>
                                    <th class="py-2 px-3 border-b text-left text-sm font-semibold text-gray-600">Cal</th>
                                    <th class="py-2 px-3 border-b text-left text-sm font-semibold text-gray-600">P</th>
                                    <th class="py-2 px-3 border-b text-left text-sm font-semibold text-gray-600">C</th>
                                    <th class="py-2 px-3 border-b text-left text-sm font-semibold text-gray-600">G</th>
                                    <th class="py-2 px-3 border-b text-left text-sm font-semibold text-gray-600">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody>`;
                
                mealList.forEach((meal, index) => {
                    typeTotalCalories += meal.calories || 0;
                    typeTotalProtein += meal.protein || 0;
                    typeTotalCarbs += meal.carbs || 0;
                    typeTotalFat += meal.fat || 0;
                    
                    const originalIndex = meals[date].indexOf(meal); 

                    html += `
                        <tr class="hover:bg-gray-50 transition-colors duration-150">
                            <td class="py-2 px-3 border-b text-sm text-gray-800" data-label="Alimento">${meal.food}</td>
                            <td class="py-2 px-3 border-b text-sm text-gray-800" data-label="Qtd">${meal.quantity} ${meal.unit}</td>
                            <td class="py-2 px-3 border-b text-sm text-gray-800" data-label="Cal">${Math.round(meal.calories || 0)}</td>
                            <td class="py-2 px-3 border-b text-sm text-gray-800" data-label="P">${Math.round(meal.protein || 0)}g</td>
                            <td class="py-2 px-3 border-b text-sm text-gray-800" data-label="C">${Math.round(meal.carbs || 0)}g</td>
                            <td class="py-2 px-3 border-b text-sm text-gray-800" data-label="G">${Math.round(meal.fat || 0)}g</td>
                            <td class="py-2 px-3 border-b text-sm text-gray-800" data-label="A√ß√µes">
                                <button class="text-red-500 hover:text-red-700 transition-colors duration-200" onclick="removeMeal('${date}', ${originalIndex})" aria-label="Remover ${meal.food}">
                                    Remover
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                html += `</tbody>
                        </table>
                    </div>
                    <div class="mt-3 text-right text-sm md:text-md font-semibold text-gray-700">
                        Total para ${type}: 
                        <span class="text-green-600">${Math.round(typeTotalCalories)} kcal</span> | 
                        P: <span class="text-red-600">${Math.round(typeTotalProtein)}g</span> | 
                        C: <span class="text-blue-600">${Math.round(typeTotalCarbs)}g</span> | 
                        G: <span class="text-yellow-600">${Math.round(typeTotalFat)}g</span>
                    </div>
                </div>`;
            }
            
            DOM.dailyMealsDiv.innerHTML = html;
            updateDailyCharts();
            if (document.getElementById('refeicoes').classList.contains('active')) {
                updateMealDistributionChart();
            }
        }

        // --- Fun√ß√µes de Busca de Nutrientes (AGORA COM OS 200 ALIMENTOS) ---
        const nutritionalDatabase = {
            "frango grelhado": { "Prote√≠na (g)": 26.9, "Carboidrato (g)": 3.3, "Gordura (g)": 11.5, "Calorias (kcal)": 224 },
            "peito de frango": { "Prote√≠na (g)": 10.9, "Carboidrato (g)": 29.6, "Gordura (g)": 5.1, "Calorias (kcal)": 208 },
            "carne bovina mo√≠da": { "Prote√≠na (g)": 17.0, "Carboidrato (g)": 12.5, "Gordura (g)": 15.5, "Calorias (kcal)": 258 },
            "salm√£o": { "Prote√≠na (g)": 27.5, "Carboidrato (g)": 11.3, "Gordura (g)": 9.4, "Calorias (kcal)": 240 },
            "atum em lata": { "Prote√≠na (g)": 1.2, "Carboidrato (g)": 41.7, "Gordura (g)": 6.7, "Calorias (kcal)": 232 },
            "ovo cozido": { "Prote√≠na (g)": 12.4, "Carboidrato (g)": 57.8, "Gordura (g)": 11.3, "Calorias (kcal)": 382 },
            "clara de ovo": { "Prote√≠na (g)": 20.6, "Carboidrato (g)": 51.5, "Gordura (g)": 6.4, "Calorias (kcal)": 346 },
            "leite integral": { "Prote√≠na (g)": 16.7, "Carboidrato (g)": 22.6, "Gordura (g)": 23.0, "Calorias (kcal)": 364 },
            "leite desnatado": { "Prote√≠na (g)": 10.7, "Carboidrato (g)": 27.6, "Gordura (g)": 12.9, "Calorias (kcal)": 269 },
            "iogurte natural": { "Prote√≠na (g)": 26.4, "Carboidrato (g)": 6.4, "Gordura (g)": 19.0, "Calorias (kcal)": 302 },
            "queijo mu√ßarela": { "Prote√≠na (g)": 26.0, "Carboidrato (g)": 57.2, "Gordura (g)": 1.2, "Calorias (kcal)": 344 },
            "queijo cottage": { "Prote√≠na (g)": 4.0, "Carboidrato (g)": 41.0, "Gordura (g)": 8.4, "Calorias (kcal)": 256 },
            "arroz branco": { "Prote√≠na (g)": 8.4, "Carboidrato (g)": 36.0, "Gordura (g)": 1.2, "Calorias (kcal)": 188 },
            "arroz integral": { "Prote√≠na (g)": 20.5, "Carboidrato (g)": 50.9, "Gordura (g)": 5.5, "Calorias (kcal)": 335 },
            "feij√£o preto": { "Prote√≠na (g)": 11.8, "Carboidrato (g)": 0.2, "Gordura (g)": 22.2, "Calorias (kcal)": 248 },
            "feij√£o carioca": { "Prote√≠na (g)": 8.7, "Carboidrato (g)": 53.8, "Gordura (g)": 4.4, "Calorias (kcal)": 290 },
            "gr√£o-de-bico": { "Prote√≠na (g)": 28.9, "Carboidrato (g)": 33.5, "Gordura (g)": 10.8, "Calorias (kcal)": 347 },
            "lentilha": { "Prote√≠na (g)": 9.3, "Carboidrato (g)": 17.3, "Gordura (g)": 15.8, "Calorias (kcal)": 249 },
            "soja cozida": { "Prote√≠na (g)": 16.1, "Carboidrato (g)": 15.4, "Gordura (g)": 15.9, "Calorias (kcal)": 269 },
            "p√£o franc√™s": { "Prote√≠na (g)": 14.4, "Carboidrato (g)": 46.6, "Gordura (g)": 23.2, "Calorias (kcal)": 453 },
            "p√£o integral": { "Prote√≠na (g)": 5.2, "Carboidrato (g)": 25.6, "Gordura (g)": 24.5, "Calorias (kcal)": 344 },
            "macarr√£o cozido": { "Prote√≠na (g)": 9.1, "Carboidrato (g)": 50.1, "Gordura (g)": 3.4, "Calorias (kcal)": 267 },
            "batata inglesa": { "Prote√≠na (g)": 19.0, "Carboidrato (g)": 55.0, "Gordura (g)": 4.9, "Calorias (kcal)": 340 },
            "batata-doce": { "Prote√≠na (g)": 9.8, "Carboidrato (g)": 18.6, "Gordura (g)": 15.5, "Calorias (kcal)": 253 },
            "mandioquinha": { "Prote√≠na (g)": 21.1, "Carboidrato (g)": 38.3, "Gordura (g)": 12.3, "Calorias (kcal)": 348 },
            "mandioca": { "Prote√≠na (g)": 13.9, "Carboidrato (g)": 49.1, "Gordura (g)": 19.4, "Calorias (kcal)": 427 },
            "cenoura": { "Prote√≠na (g)": 17.0, "Carboidrato (g)": 29.1, "Gordura (g)": 6.9, "Calorias (kcal)": 246 },
            "beterraba": { "Prote√≠na (g)": 10.5, "Carboidrato (g)": 0.4, "Gordura (g)": 10.2, "Calorias (kcal)": 135 },
            "abobrinha": { "Prote√≠na (g)": 18.1, "Carboidrato (g)": 27.2, "Gordura (g)": 5.1, "Calorias (kcal)": 227 },
            "berinjela": { "Prote√≠na (g)": 25.8, "Carboidrato (g)": 25.4, "Gordura (g)": 8.7, "Calorias (kcal)": 283 },
            "espinafre": { "Prote√≠na (g)": 25.5, "Carboidrato (g)": 33.7, "Gordura (g)": 7.5, "Calorias (kcal)": 304 },
            "couve": { "Prote√≠na (g)": 1.8, "Carboidrato (g)": 52.9, "Gordura (g)": 22.0, "Calorias (kcal)": 417 },
            "alface": { "Prote√≠na (g)": 13.3, "Carboidrato (g)": 44.3, "Gordura (g)": 16.0, "Calorias (kcal)": 374 },
            "r√∫cula": { "Prote√≠na (g)": 14.4, "Carboidrato (g)": 37.5, "Gordura (g)": 20.3, "Calorias (kcal)": 390 },
            "tomate": { "Prote√≠na (g)": 12.6, "Carboidrato (g)": 5.4, "Gordura (g)": 8.4, "Calorias (kcal)": 148 },
            "pepino": { "Prote√≠na (g)": 0.2, "Carboidrato (g)": 59.0, "Gordura (g)": 16.6, "Calorias (kcal)": 386 },
            "br√≥colis": { "Prote√≠na (g)": 23.0, "Carboidrato (g)": 45.8, "Gordura (g)": 12.0, "Calorias (kcal)": 383 },
            "couve-flor": { "Prote√≠na (g)": 26.7, "Carboidrato (g)": 18.0, "Gordura (g)": 12.0, "Calorias (kcal)": 287 },
            "milho verde": { "Prote√≠na (g)": 24.9, "Carboidrato (g)": 7.9, "Gordura (g)": 9.8, "Calorias (kcal)": 219 },
            "ervilha": { "Prote√≠na (g)": 22.2, "Carboidrato (g)": 44.2, "Gordura (g)": 8.7, "Calorias (kcal)": 344 },
            "ma√ß√£": { "Prote√≠na (g)": 27.5, "Carboidrato (g)": 48.3, "Gordura (g)": 5.2, "Calorias (kcal)": 350 },
            "banana": { "Prote√≠na (g)": 5.4, "Carboidrato (g)": 25.4, "Gordura (g)": 13.0, "Calorias (kcal)": 240 },
            "pera": { "Prote√≠na (g)": 19.1, "Carboidrato (g)": 11.3, "Gordura (g)": 15.7, "Calorias (kcal)": 263 },
            "mam√£o": { "Prote√≠na (g)": 13.2, "Carboidrato (g)": 10.8, "Gordura (g)": 11.7, "Calorias (kcal)": 201 },
            "abacaxi": { "Prote√≠na (g)": 2.9, "Carboidrato (g)": 22.8, "Gordura (g)": 4.3, "Calorias (kcal)": 142 },
            "laranja": { "Prote√≠na (g)": 13.6, "Carboidrato (g)": 40.0, "Gordura (g)": 23.5, "Calorias (kcal)": 426 },
            "melancia": { "Prote√≠na (g)": 19.4, "Carboidrato (g)": 25.3, "Gordura (g)": 9.9, "Calorias (kcal)": 268 },
            "mel√£o": { "Prote√≠na (g)": 22.4, "Carboidrato (g)": 21.0, "Gordura (g)": 21.6, "Calorias (kcal)": 368 },
            "uva": { "Prote√≠na (g)": 23.4, "Carboidrato (g)": 40.1, "Gordura (g)": 15.6, "Calorias (kcal)": 394 },
            "morango": { "Prote√≠na (g)": 1.5, "Carboidrato (g)": 49.1, "Gordura (g)": 5.9, "Calorias (kcal)": 256 },
            "amendoim": { "Prote√≠na (g)": 12.0, "Carboidrato (g)": 42.1, "Gordura (g)": 12.9, "Calorias (kcal)": 332 },
            "castanha-do-par√°": { "Prote√≠na (g)": 2.2, "Carboidrato (g)": 41.1, "Gordura (g)": 20.9, "Calorias (kcal)": 361 },
            "castanha de caju": { "Prote√≠na (g)": 0.6, "Carboidrato (g)": 27.4, "Gordura (g)": 20.7, "Calorias (kcal)": 298 },
            "nozes": { "Prote√≠na (g)": 11.7, "Carboidrato (g)": 34.3, "Gordura (g)": 3.1, "Calorias (kcal)": 212 },
            "am√™ndoas": { "Prote√≠na (g)": 19.7, "Carboidrato (g)": 27.5, "Gordura (g)": 14.7, "Calorias (kcal)": 321 },
            "aveia": { "Prote√≠na (g)": 16.2, "Carboidrato (g)": 13.4, "Gordura (g)": 16.8, "Calorias (kcal)": 270 },
            "centeio": { "Prote√≠na (g)": 6.5, "Carboidrato (g)": 21.4, "Gordura (g)": 20.4, "Calorias (kcal)": 295 },
            "trigo": { "Prote√≠na (g)": 3.2, "Carboidrato (g)": 32.9, "Gordura (g)": 15.8, "Calorias (kcal)": 287 },
            "farinha de trigo": { "Prote√≠na (g)": 12.6, "Carboidrato (g)": 50.9, "Gordura (g)": 5.3, "Calorias (kcal)": 302 },
            "farinha de aveia": { "Prote√≠na (g)": 7.8, "Carboidrato (g)": 47.1, "Gordura (g)": 13.6, "Calorias (kcal)": 342 },
            "quinoa": { "Prote√≠na (g)": 20.0, "Carboidrato (g)": 11.1, "Gordura (g)": 22.7, "Calorias (kcal)": 329 },
            "chia": { "Prote√≠na (g)": 27.5, "Carboidrato (g)": 24.2, "Gordura (g)": 15.6, "Calorias (kcal)": 347 },
            "linha√ßa": { "Prote√≠na (g)": 24.6, "Carboidrato (g)": 17.0, "Gordura (g)": 24.6, "Calorias (kcal)": 388 },
            "cacau em p√≥": { "Prote√≠na (g)": 15.2, "Carboidrato (g)": 12.2, "Gordura (g)": 3.1, "Calorias (kcal)": 138 },
            "chocolate ao leite": { "Prote√≠na (g)": 3.3, "Carboidrato (g)": 26.4, "Gordura (g)": 1.8, "Calorias (kcal)": 135 },
            "chocolate meio amargo": { "Prote√≠na (g)": 20.3, "Carboidrato (g)": 43.3, "Gordura (g)": 7.0, "Calorias (kcal)": 317 },
            "refrigerante": { "Prote√≠na (g)": 5.6, "Carboidrato (g)": 28.0, "Gordura (g)": 23.1, "Calorias (kcal)": 342 },
            "suco de laranja": { "Prote√≠na (g)": 13.8, "Carboidrato (g)": 35.4, "Gordura (g)": 21.0, "Calorias (kcal)": 386 },
            "suco de uva": { "Prote√≠na (g)": 2.3, "Carboidrato (g)": 14.0, "Gordura (g)": 17.3, "Calorias (kcal)": 221 },
            "√°gua de coco": { "Prote√≠na (g)": 26.7, "Carboidrato (g)": 31.1, "Gordura (g)": 24.8, "Calorias (kcal)": 454 },
            "caf√©": { "Prote√≠na (g)": 24.2, "Carboidrato (g)": 38.7, "Gordura (g)": 10.2, "Calorias (kcal)": 343 },
            "ch√° verde": { "Prote√≠na (g)": 5.7, "Carboidrato (g)": 57.3, "Gordura (g)": 13.4, "Calorias (kcal)": 373 },
            "ch√° preto": { "Prote√≠na (g)": 0.6, "Carboidrato (g)": 38.8, "Gordura (g)": 18.7, "Calorias (kcal)": 326 },
            "azeite de oliva": { "Prote√≠na (g)": 18.8, "Carboidrato (g)": 1.9, "Gordura (g)": 17.8, "Calorias (kcal)": 243 },
            "√≥leo de soja": { "Prote√≠na (g)": 17.2, "Carboidrato (g)": 18.3, "Gordura (g)": 9.5, "Calorias (kcal)": 228 },
            "manteiga": { "Prote√≠na (g)": 5.4, "Carboidrato (g)": 1.9, "Gordura (g)": 5.5, "Calorias (kcal)": 79 },
            "margarina": { "Prote√≠na (g)": 0.7, "Carboidrato (g)": 16.6, "Gordura (g)": 2.6, "Calorias (kcal)": 93 },
            "maionese": { "Prote√≠na (g)": 26.2, "Carboidrato (g)": 15.8, "Gordura (g)": 3.7, "Calorias (kcal)": 201 },
            "molho de tomate": { "Prote√≠na (g)": 21.1, "Carboidrato (g)": 23.2, "Gordura (g)": 17.9, "Calorias (kcal)": 338 },
            "ketchup": { "Prote√≠na (g)": 25.5, "Carboidrato (g)": 49.6, "Gordura (g)": 19.5, "Calorias (kcal)": 476 },
            "mostarda": { "Prote√≠na (g)": 22.2, "Carboidrato (g)": 59.9, "Gordura (g)": 11.7, "Calorias (kcal)": 434 },
            "molho shoyu": { "Prote√≠na (g)": 13.7, "Carboidrato (g)": 29.4, "Gordura (g)": 23.1, "Calorias (kcal)": 380 },
            "molho barbecue": { "Prote√≠na (g)": 12.9, "Carboidrato (g)": 39.8, "Gordura (g)": 8.5, "Calorias (kcal)": 287 },
            "salsicha": { "Prote√≠na (g)": 10.9, "Carboidrato (g)": 0.1, "Gordura (g)": 2.0, "Calorias (kcal)": 62 },
            "presunto": { "Prote√≠na (g)": 7.0, "Carboidrato (g)": 13.2, "Gordura (g)": 14.1, "Calorias (kcal)": 208 },
            "mortadela": { "Prote√≠na (g)": 13.7, "Carboidrato (g)": 13.0, "Gordura (g)": 19.6, "Calorias (kcal)": 283 },
            "salame": { "Prote√≠na (g)": 23.0, "Carboidrato (g)": 3.9, "Gordura (g)": 8.4, "Calorias (kcal)": 183 },
            "peito de peru": { "Prote√≠na (g)": 13.7, "Carboidrato (g)": 4.0, "Gordura (g)": 8.0, "Calorias (kcal)": 143 },
            "hamb√∫rguer bovino": { "Prote√≠na (g)": 23.7, "Carboidrato (g)": 40.2, "Gordura (g)": 23.1, "Calorias (kcal)": 464 },
            "hamb√∫rguer de frango": { "Prote√≠na (g)": 27.9, "Carboidrato (g)": 54.0, "Gordura (g)": 4.1, "Calorias (kcal)": 364 },
            "nuggets": { "Prote√≠na (g)": 26.3, "Carboidrato (g)": 18.9, "Gordura (g)": 0.9, "Calorias (kcal)": 189 },
            "pizza de mussarela": { "Prote√≠na (g)": 25.9, "Carboidrato (g)": 51.8, "Gordura (g)": 0.6, "Calorias (kcal)": 316 },
            "pizza de calabresa": { "Prote√≠na (g)": 27.0, "Carboidrato (g)": 9.8, "Gordura (g)": 2.1, "Calorias (kcal)": 166 },
            "lasagna": { "Prote√≠na (g)": 0.6, "Carboidrato (g)": 42.0, "Gordura (g)": 23.1, "Calorias (kcal)": 378 },
            "strogonoff de frango": { "Prote√≠na (g)": 7.1, "Carboidrato (g)": 30.9, "Gordura (g)": 21.7, "Calorias (kcal)": 347 },
            "esfiha": { "Prote√≠na (g)": 11.0, "Carboidrato (g)": 17.8, "Gordura (g)": 15.8, "Calorias (kcal)": 257 },
            "coxinha": { "Prote√≠na (g)": 4.0, "Carboidrato (g)": 35.9, "Gordura (g)": 22.3, "Calorias (kcal)": 360 },
            "pastel de carne": { "Prote√≠na (g)": 26.8, "Carboidrato (g)": 50.3, "Gordura (g)": 22.4, "Calorias (kcal)": 510 },
            "pastel de queijo": { "Prote√≠na (g)": 13.6, "Carboidrato (g)": 18.4, "Gordura (g)": 11.8, "Calorias (kcal)": 234 },
            "empada": { "Prote√≠na (g)": 12.5, "Carboidrato (g)": 9.0, "Gordura (g)": 7.6, "Calorias (kcal)": 154 },
            "sopa de legumes": { "Prote√≠na (g)": 18.5, "Carboidrato (g)": 42.3, "Gordura (g)": 11.2, "Calorias (kcal)": 344 },
            "sopa de feij√£o": { "Prote√≠na (g)": 3.6, "Carboidrato (g)": 57.3, "Gordura (g)": 8.4, "Calorias (kcal)": 319 },
            "sopa de frango": { "Prote√≠na (g)": 10.6, "Carboidrato (g)": 59.3, "Gordura (g)": 13.9, "Calorias (kcal)": 405 },
            "caldo verde": { "Prote√≠na (g)": 8.5, "Carboidrato (g)": 56.6, "Gordura (g)": 16.9, "Calorias (kcal)": 412 },
            "canja de galinha": { "Prote√≠na (g)": 7.8, "Carboidrato (g)": 8.4, "Gordura (g)": 21.6, "Calorias (kcal)": 259 },
            "bolo de chocolate": { "Prote√≠na (g)": 23.8, "Carboidrato (g)": 5.2, "Gordura (g)": 13.5, "Calorias (kcal)": 238 },
            "bolo de cenoura": { "Prote√≠na (g)": 25.8, "Carboidrato (g)": 44.7, "Gordura (g)": 10.5, "Calorias (kcal)": 376 },
            "pudim": { "Prote√≠na (g)": 9.7, "Carboidrato (g)": 50.6, "Gordura (g)": 8.7, "Calorias (kcal)": 320 },
            "gelatina": { "Prote√≠na (g)": 19.0, "Carboidrato (g)": 7.2, "Gordura (g)": 0.1, "Calorias (kcal)": 106 },
            "sorvete de creme": { "Prote√≠na (g)": 18.9, "Carboidrato (g)": 17.1, "Gordura (g)": 13.3, "Calorias (kcal)": 264 },
            "a√ßa√≠ com granola": { "Prote√≠na (g)": 18.2, "Carboidrato (g)": 10.3, "Gordura (g)": 24.9, "Calorias (kcal)": 338 },
            "granola": { "Prote√≠na (g)": 14.9, "Carboidrato (g)": 4.1, "Gordura (g)": 13.7, "Calorias (kcal)": 199 },
            "barra de cereal": { "Prote√≠na (g)": 16.4, "Carboidrato (g)": 49.2, "Gordura (g)": 17.9, "Calorias (kcal)": 424 },
            "barrinha proteica": { "Prote√≠na (g)": 21.3, "Carboidrato (g)": 46.9, "Gordura (g)": 15.6, "Calorias (kcal)": 413 },
            "whey protein": { "Prote√≠na (g)": 21.0, "Carboidrato (g)": 17.1, "Gordura (g)": 0.4, "Calorias (kcal)": 156 },
            "tofu": { "Prote√≠na (g)": 24.7, "Carboidrato (g)": 50.8, "Gordura (g)": 2.0, "Calorias (kcal)": 320 },
            "prote√≠na de soja": { "Prote√≠na (g)": 21.8, "Carboidrato (g)": 15.6, "Gordura (g)": 10.4, "Calorias (kcal)": 243 },
            "seitan": { "Prote√≠na (g)": 8.6, "Carboidrato (g)": 0.7, "Gordura (g)": 12.7, "Calorias (kcal)": 152 },
            "tempeh": { "Prote√≠na (g)": 12.3, "Carboidrato (g)": 10.3, "Gordura (g)": 3.8, "Calorias (kcal)": 125 },
            "hamb√∫rguer vegetal": { "Prote√≠na (g)": 0.6, "Carboidrato (g)": 52.0, "Gordura (g)": 10.4, "Calorias (kcal)": 304 },
            "pipoca": { "Prote√≠na (g)": 8.5, "Carboidrato (g)": 30.5, "Gordura (g)": 7.9, "Calorias (kcal)": 227 },
            "torrada": { "Prote√≠na (g)": 17.1, "Carboidrato (g)": 16.7, "Gordura (g)": 13.3, "Calorias (kcal)": 255 },
            "biscoito de √°gua e sal": { "Prote√≠na (g)": 21.6, "Carboidrato (g)": 5.5, "Gordura (g)": 24.6, "Calorias (kcal)": 330 },
            "biscoito recheado": { "Prote√≠na (g)": 7.8, "Carboidrato (g)": 8.5, "Gordura (g)": 8.9, "Calorias (kcal)": 145 },
            "bolacha maria": { "Prote√≠na (g)": 26.5, "Carboidrato (g)": 47.6, "Gordura (g)": 20.8, "Calorias (kcal)": 484 },
            "croissant": { "Prote√≠na (g)": 0.3, "Carboidrato (g)": 1.3, "Gordura (g)": 9.4, "Calorias (kcal)": 91 },
            "p√£o de queijo": { "Prote√≠na (g)": 8.6, "Carboidrato (g)": 57.8, "Gordura (g)": 0.9, "Calorias (kcal)": 274 },
            "p√£o doce": { "Prote√≠na (g)": 10.2, "Carboidrato (g)": 28.9, "Gordura (g)": 24.8, "Calorias (kcal)": 380 },
            "panqueca": { "Prote√≠na (g)": 11.3, "Carboidrato (g)": 50.7, "Gordura (g)": 23.7, "Calorias (kcal)": 461 },
            "crepioca": { "Prote√≠na (g)": 26.2, "Carboidrato (g)": 4.5, "Gordura (g)": 16.9, "Calorias (kcal)": 275 },
            "tapioca": { "Prote√≠na (g)": 6.8, "Carboidrato (g)": 42.9, "Gordura (g)": 21.8, "Calorias (kcal)": 395 },
            "cuscuz": { "Prote√≠na (g)": 11.9, "Carboidrato (g)": 55.4, "Gordura (g)": 12.0, "Calorias (kcal)": 377 },
            "polenta": { "Prote√≠na (g)": 8.0, "Carboidrato (g)": 0.3, "Gordura (g)": 19.2, "Calorias (kcal)": 206 },
            "pur√™ de batata": { "Prote√≠na (g)": 2.9, "Carboidrato (g)": 53.1, "Gordura (g)": 4.4, "Calorias (kcal)": 264 },
            "farofa": { "Prote√≠na (g)": 14.3, "Carboidrato (g)": 27.3, "Gordura (g)": 2.8, "Calorias (kcal)": 192 },
            "repolho": { "Prote√≠na (g)": 8.5, "Carboidrato (g)": 38.6, "Gordura (g)": 9.6, "Calorias (kcal)": 275 },
            "nabo": { "Prote√≠na (g)": 12.8, "Carboidrato (g)": 51.0, "Gordura (g)": 0.2, "Calorias (kcal)": 257 },
            "jil√≥": { "Prote√≠na (g)": 0.2, "Carboidrato (g)": 31.3, "Gordura (g)": 19.8, "Calorias (kcal)": 304 },
            "chuchu": { "Prote√≠na (g)": 26.5, "Carboidrato (g)": 35.3, "Gordura (g)": 11.8, "Calorias (kcal)": 353 },
            "palmito": { "Prote√≠na (g)": 1.0, "Carboidrato (g)": 3.5, "Gordura (g)": 1.1, "Calorias (kcal)": 28 },
            "alcachofra": { "Prote√≠na (g)": 24.4, "Carboidrato (g)": 4.1, "Gordura (g)": 13.5, "Calorias (kcal)": 236 },
            "quiabo": { "Prote√≠na (g)": 21.7, "Carboidrato (g)": 1.6, "Gordura (g)": 3.4, "Calorias (kcal)": 124 },
            "maxixe": { "Prote√≠na (g)": 18.0, "Carboidrato (g)": 7.3, "Gordura (g)": 1.7, "Calorias (kcal)": 116 },
            "inhame": { "Prote√≠na (g)": 27.5, "Carboidrato (g)": 48.7, "Gordura (g)": 13.2, "Calorias (kcal)": 424 },
            "car√°": { "Prote√≠na (g)": 18.3, "Carboidrato (g)": 4.0, "Gordura (g)": 13.8, "Calorias (kcal)": 213 },
            "kiwi": { "Prote√≠na (g)": 14.3, "Carboidrato (g)": 38.6, "Gordura (g)": 14.5, "Calorias (kcal)": 342 },
            "coco": { "Prote√≠na (g)": 29.6, "Carboidrato (g)": 43.6, "Gordura (g)": 5.4, "Calorias (kcal)": 341 },
            "caj√°": { "Prote√≠na (g)": 11.4, "Carboidrato (g)": 13.6, "Gordura (g)": 16.5, "Calorias (kcal)": 248 },
            "caju": { "Prote√≠na (g)": 21.8, "Carboidrato (g)": 25.6, "Gordura (g)": 6.9, "Calorias (kcal)": 252 },
            "jabuticaba": { "Prote√≠na (g)": 17.3, "Carboidrato (g)": 1.2, "Gordura (g)": 14.2, "Calorias (kcal)": 202 },
            "acerola": { "Prote√≠na (g)": 26.7, "Carboidrato (g)": 42.5, "Gordura (g)": 10.5, "Calorias (kcal)": 371 },
            "graviola": { "Prote√≠na (g)": 11.4, "Carboidrato (g)": 23.0, "Gordura (g)": 9.0, "Calorias (kcal)": 219 },
            "goiaba": { "Prote√≠na (g)": 19.9, "Carboidrato (g)": 40.9, "Gordura (g)": 17.9, "Calorias (kcal)": 404 },
            "tamarindo": { "Prote√≠na (g)": 19.7, "Carboidrato (g)": 50.5, "Gordura (g)": 0.2, "Calorias (kcal)": 283 },
            "seriguela": { "Prote√≠na (g)": 20.2, "Carboidrato (g)": 6.1, "Gordura (g)": 14.8, "Calorias (kcal)": 238 },
            "bacaba": { "Prote√≠na (g)": 7.8, "Carboidrato (g)": 38.2, "Gordura (g)": 22.3, "Calorias (kcal)": 385 },
            "bacuri": { "Prote√≠na (g)": 14.5, "Carboidrato (g)": 18.2, "Gordura (g)": 17.4, "Calorias (kcal)": 287 },
            "cupua√ßu": { "Prote√≠na (g)": 26.7, "Carboidrato (g)": 22.7, "Gordura (g)": 18.6, "Calorias (kcal)": 365 },
            "buriti": { "Prote√≠na (g)": 9.9, "Carboidrato (g)": 49.1, "Gordura (g)": 15.3, "Calorias (kcal)": 374 },
            "pequi": { "Prote√≠na (g)": 30.0, "Carboidrato (g)": 41.2, "Gordura (g)": 24.2, "Calorias (kcal)": 503 },
            "almeir√£o": { "Prote√≠na (g)": 20.1, "Carboidrato (g)": 52.0, "Gordura (g)": 18.1, "Calorias (kcal)": 451 },
            "agri√£o": { "Prote√≠na (g)": 2.4, "Carboidrato (g)": 24.0, "Gordura (g)": 7.2, "Calorias (kcal)": 170 },
            "alho-por√≥": { "Prote√≠na (g)": 16.9, "Carboidrato (g)": 52.5, "Gordura (g)": 21.8, "Calorias (kcal)": 474 },
            "end√≠via": { "Prote√≠na (g)": 2.0, "Carboidrato (g)": 9.2, "Gordura (g)": 15.7, "Calorias (kcal)": 186 },
            "escarola": { "Prote√≠na (g)": 12.1, "Carboidrato (g)": 39.6, "Gordura (g)": 15.8, "Calorias (kcal)": 349 },
            "piment√£o": { "Prote√≠na (g)": 16.9, "Carboidrato (g)": 29.0, "Gordura (g)": 12.3, "Calorias (kcal)": 294 },
            "cebola": { "Prote√≠na (g)": 12.3, "Carboidrato (g)": 6.6, "Gordura (g)": 18.9, "Calorias (kcal)": 246 },
            "alho": { "Prote√≠na (g)": 4.9, "Carboidrato (g)": 2.0, "Gordura (g)": 20.8, "Calorias (kcal)": 215 },
            "gengibre": { "Prote√≠na (g)": 8.8, "Carboidrato (g)": 1.2, "Gordura (g)": 15.1, "Calorias (kcal)": 176 },
            "pimenta": { "Prote√≠na (g)": 6.5, "Carboidrato (g)": 43.7, "Gordura (g)": 2.6, "Calorias (kcal)": 224 },
            "canela": { "Prote√≠na (g)": 9.5, "Carboidrato (g)": 24.6, "Gordura (g)": 20.2, "Calorias (kcal)": 318 },
            "cravo": { "Prote√≠na (g)": 29.0, "Carboidrato (g)": 52.0, "Gordura (g)": 2.8, "Calorias (kcal)": 349 },
            "noz-moscada": { "Prote√≠na (g)": 4.2, "Carboidrato (g)": 38.7, "Gordura (g)": 20.7, "Calorias (kcal)": 358 },
            "manjeric√£o": { "Prote√≠na (g)": 24.8, "Carboidrato (g)": 4.2, "Gordura (g)": 10.3, "Calorias (kcal)": 209 },
            "or√©gano": { "Prote√≠na (g)": 24.9, "Carboidrato (g)": 12.6, "Gordura (g)": 18.3, "Calorias (kcal)": 315 },
            "salsinha": { "Prote√≠na (g)": 28.1, "Carboidrato (g)": 50.4, "Gordura (g)": 9.7, "Calorias (kcal)": 401 },
            "cebolinha": { "Prote√≠na (g)": 15.9, "Carboidrato (g)": 43.9, "Gordura (g)": 4.0, "Calorias (kcal)": 275 },
            "coentro": { "Prote√≠na (g)": 29.8, "Carboidrato (g)": 35.3, "Gordura (g)": 24.2, "Calorias (kcal)": 478 },
            "hortel√£": { "Prote√≠na (g)": 25.9, "Carboidrato (g)": 16.2, "Gordura (g)": 7.3, "Calorias (kcal)": 234 },
            "erva-doce": { "Prote√≠na (g)": 10.7, "Carboidrato (g)": 44.7, "Gordura (g)": 15.5, "Calorias (kcal)": 361 },
            "levedo de cerveja": { "Prote√≠na (g)": 3.8, "Carboidrato (g)": 10.1, "Gordura (g)": 9.1, "Calorias (kcal)": 138 },
            "fermento biol√≥gico": { "Prote√≠na (g)": 1.4, "Carboidrato (g)": 9.5, "Gordura (g)": 7.8, "Calorias (kcal)": 114 },
            "gelatina sem sabor": { "Prote√≠na (g)": 25.8, "Carboidrato (g)": 27.1, "Gordura (g)": 11.8, "Calorias (kcal)": 318 },
            "√°gar-√°gar": { "Prote√≠na (g)": 14.7, "Carboidrato (g)": 0.6, "Gordura (g)": 2.8, "Calorias (kcal)": 86 },
            "clara em p√≥": { "Prote√≠na (g)": 2.3, "Carboidrato (g)": 20.4, "Gordura (g)": 22.5, "Calorias (kcal)": 293 }
        };

        async function getNutritionalData(foodName, quantity, unit) {
            // Simula um atraso de rede para feedback visual
            await new Promise(resolve => setTimeout(resolve, 300)); 

            const normalizedFoodName = foodName.toLowerCase().trim();
            const data = nutritionalDatabase[normalizedFoodName];

            if (!data) {
                showToast(`Alimento "${foodName}" n√£o encontrado na base de dados. Por favor, verifique a grafia ou adicione manualmente.`, 'error');
                return { calories: 0, protein: 0, carbs: 0, fat: 0 };
            }

            let multiplier = 1;
            // A tabela √© por 100g. Se a unidade for 'g' ou 'ml', o multiplicador √© (quantidade / 100).
            // Para 'un', precisamos de uma estimativa ou o usu√°rio deve inserir o peso em 'g' ou 'ml'.
            if (unit === 'g' || unit === 'ml') {
                multiplier = quantity / 100;
            } else if (unit === 'un') {
                // Para 'un', tentamos estimar um peso m√©dio. Se n√£o houver, assumimos 100g/ml.
                // Voc√™ pode expandir este mapeamento para mais alimentos comuns em 'un'.
                if (normalizedFoodName.includes("ovo")) {
                    multiplier = (quantity * 60) / 100; // Assumindo 1 ovo m√©dio = 60g
                } else if (normalizedFoodName.includes("ma√ß√£") || normalizedFoodName.includes("banana") || normalizedFoodName.includes("laranja")) {
                    multiplier = (quantity * 150) / 100; // Assumindo 1 fruta m√©dia = 150g
                } else if (normalizedFoodName.includes("p√£o franc√™s")) {
                    multiplier = (quantity * 50) / 100; // Assumindo 1 p√£o franc√™s = 50g
                } else {
                    // Se n√£o houver mapeamento espec√≠fico para 'un', assumimos que 1 unidade √© 100g/ml
                    // e o usu√°rio deve ajustar a quantidade para refletir o peso real.
                    showToast(`Para "${foodName}", a unidade 'un' √© uma estimativa. Considere usar 'g' ou 'ml' para maior precis√£o.`, 'info');
                    multiplier = quantity / 100; 
                }
            }

            return {
                calories: data["Calorias (kcal)"] * multiplier,
                protein: data["Prote√≠na (g)"] * multiplier,
                carbs: data["Carboidrato (g)"] * multiplier,
                fat: data["Gordura (g)"] * multiplier
            };
        }

        DOM.addFoodBtn.addEventListener('click', async () => {
            const date = DOM.dateInput.value;
            const type = document.getElementById('meal-type').value;
            const food = document.getElementById('food-name').value.trim();
            const quantity = parseFloat(document.getElementById('food-quantity').value);
            const unit = document.getElementById('quantity-unit').value;
            
            if (!date || !type || !food || isNaN(quantity) || quantity <= 0) {
                showToast('Por favor, preencha todos os campos obrigat√≥rios com valores v√°lidos (Alimento, Quantidade > 0).', 'error');
                return;
            }

            DOM.addFoodBtn.disabled = true;
            DOM.addFoodLoader.classList.remove('hidden');
            
            try {
                const nutritionalData = await getNutritionalData(food, quantity, unit);

                if (nutritionalData.calories === 0 && nutritionalData.protein === 0 && nutritionalData.carbs === 0 && nutritionalData.fat === 0) {
                    // Se o alimento n√£o foi encontrado na base de dados, a fun√ß√£o getNutritionalData j√° exibiu um toast.
                    // Aqui, podemos decidir se queremos adicionar um item "vazio" ou abortar.
                    // Por enquanto, vamos abortar para n√£o adicionar dados incorretos.
                    showToast(`N√£o foi poss√≠vel adicionar "${food}" sem dados nutricionais v√°lidos.`, 'error');
                    return;
                }
                
                const newMeal = {
                    type,
                    food,
                    quantity,
                    unit,
                    calories: nutritionalData.calories,
                    protein: nutritionalData.protein,
                    carbs: nutritionalData.carbs,
                    fat: nutritionalData.fat
                };
                
                if (!meals[date]) {
                    meals[date] = [];
                }
                meals[date].push(newMeal);
                
                document.getElementById('food-name').value = '';
                document.getElementById('food-quantity').value = '';
                
                loadDayMeals(date);
                saveAllData();
                showToast('Alimento adicionado com sucesso!', 'success');
            } catch (error) {
                console.error("Erro ao adicionar alimento:", error);
                showToast("Ocorreu um erro ao adicionar o alimento. Tente novamente.", 'error');
            } finally {
                DOM.addFoodBtn.disabled = false;
                DOM.addFoodLoader.classList.add('hidden');
            }
        });

        window.removeMeal = function(date, index) {
            if (confirm('Tem certeza que deseja remover esta refei√ß√£o?')) {
                if (meals[date] && meals[date][index]) {
                    meals[date].splice(index, 1);
                    if (meals[date].length === 0) {
                        delete meals[date];
                    }
                    loadDayMeals(date);
                    saveAllData();
                    showToast('Refei√ß√£o removida com sucesso!', 'success');
                }
            }
        };

        DOM.dateInput.addEventListener('change', function() {
            loadDayMeals(this.value);
        });

        // --- Aba Refei√ß√µes (Planejamento de Refei√ß√µes) ---
        DOM.addMealTemplateBtn.addEventListener('click', () => {
            const type = document.getElementById('meal-type-template').value;
            const name = document.getElementById('meal-name-template').value.trim();
            
            if (!name) {
                showToast('Por favor, insira um nome para a refei√ß√£o.', 'error');
                return;
            }
            
            if (!mealTemplates[type]) {
                mealTemplates[type] = [];
            }
            
            mealTemplates[type].push({
                name,
                foods: []
            });
            
            showToast('Template de refei√ß√£o criado com sucesso!', 'success');
            document.getElementById('meal-name-template').value = '';
            updateMealCards();
            saveAllData();
        });

        function updateMealCards() {
            DOM.mealCardsContainer.innerHTML = '';
            
            let hasMeals = false;
            const orderedMealTypes = ['Caf√© da Manh√£', 'Lanche da Manh√£', 'Almo√ßo', 'Lanche da Tarde', 'Jantar', 'Ceia'];

            orderedMealTypes.forEach(type => {
                if (mealTemplates[type] && mealTemplates[type].length > 0) {
                    hasMeals = true;
                    mealTemplates[type].forEach((template, templateIndex) => {
                        const card = document.createElement('div');
                        card.className = 'bg-white p-4 md:p-5 rounded-lg shadow-md border border-gray-200 mb-4 transform transition-transform hover:scale-[1.01]';
                        
                        let foodsHtml = '';
                        let totalTemplateCalories = 0;
                        let totalTemplateProtein = 0;
                        let totalTemplateCarbs = 0;
                        let totalTemplateFat = 0;

                        if (template.foods.length > 0) {
                            foodsHtml += `<h5 class="font-semibold text-gray-700 mt-3 mb-2 text-sm">Alimentos:</h5>
                                <ul class="list-disc pl-5 text-sm text-gray-600 space-y-1">`;
                            template.foods.forEach((foodItem, foodIndex) => {
                                totalTemplateCalories += foodItem.calories;
                                totalTemplateProtein += foodItem.protein;
                                totalTemplateCarbs += foodItem.carbs;
                                totalTemplateFat += foodItem.fat;
                                foodsHtml += `<li>${foodItem.food} (${foodItem.quantity}${foodItem.unit}) - ${Math.round(foodItem.calories)}kcal 
                                    <button class="text-red-400 hover:text-red-600 ml-2 transition-colors duration-200" onclick="removeFoodFromTemplate('${type}', ${templateIndex}, ${foodIndex})" aria-label="Remover ${foodItem.food} do template">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </li>`;
                            });
                            foodsHtml += `</ul>
                                <p class="text-sm text-gray-700 mt-3 font-medium">Total: <span class="text-green-600">${Math.round(totalTemplateCalories)}kcal</span> | P:<span class="text-red-600">${Math.round(totalTemplateProtein)}g</span> | C:<span class="text-blue-600">${Math.round(totalTemplateCarbs)}g</span> | G:<span class="text-yellow-600">${Math.round(totalTemplateFat)}g</span></p>`;
                        } else {
                            foodsHtml += `<p class="text-sm text-gray-500 mt-2">Nenhum alimento adicionado a este template.</p>`;
                        }

                        card.innerHTML = `
                            <h4 class="font-bold text-lg md:text-xl text-green-700">${template.name}</h4>
                            <p class="text-sm text-gray-500 mb-2">${type}</p>
                            ${foodsHtml}
                            <div class="mt-4 pt-4 border-t border-gray-100">
                                <h5 class="font-semibold text-gray-700 mb-2 text-sm">Adicionar Alimento ao Template:</h5>
                                <div class="flex flex-wrap items-end gap-2">
                                    <input type="text" id="template-food-name-${type}-${templateIndex}" class="flex-grow p-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-green-400" placeholder="Nome do alimento">
                                    <input type="number" id="template-food-quantity-${type}-${templateIndex}" class="w-20 p-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-green-400" placeholder="Qtd">
                                    <select id="template-quantity-unit-${type}-${templateIndex}" class="p-2 border border-gray-300 rounded-md text-sm bg-white focus:ring-2 focus:ring-green-400">
                                        <option value="g">g</option>
                                        <option value="ml">ml</option>
                                        <option value="un">un</option>
                                    </select>
                                    <button type="button" class="bg-green-600 text-white px-3 py-2 rounded-md text-sm font-semibold hover:bg-green-700 transition-all duration-300 transform hover:scale-105 shadow-sm flex items-center justify-center" 
                                            onclick="addFoodToTemplate('${type}', ${templateIndex})" aria-label="Adicionar alimento ao template">
                                        Add <span id="template-food-loader-${type}-${templateIndex}" class="loader hidden"></span>
                                    </button>
                                </div>
                            </div>
                            <button class="text-red-500 hover:text-red-700 mt-4 text-sm font-medium transition-colors duration-200" onclick="removeMealTemplate('${type}', ${templateIndex})" aria-label="Remover Template de Refei√ß√£o">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                </svg>
                                Remover Template
                            </button>
                        `;
                        DOM.mealCardsContainer.appendChild(card);
                    });
                }
            });

            if (!hasMeals) {
                DOM.mealCardsContainer.innerHTML = `
                    <div class="border border-dashed border-gray-300 rounded-lg p-6 md:p-8 text-center text-gray-500">
                        <p>Nenhum template de refei√ß√£o criado ainda.</p>
                        <p class="text-sm mt-2">Use o formul√°rio ao lado para come√ßar!</p>
                    </div>
                `;
            }
        }

        window.addFoodToTemplate = async function(type, templateIndex) {
            const foodNameInput = document.getElementById(`template-food-name-${type}-${templateIndex}`);
            const quantityInput = document.getElementById(`template-food-quantity-${type}-${templateIndex}`);
            const unitSelect = document.getElementById(`template-quantity-unit-${type}-${templateIndex}`);
            const loader = document.getElementById(`template-food-loader-${type}-${templateIndex}`);
            const addButton = loader.parentElement;

            const food = foodNameInput.value.trim();
            const quantity = parseFloat(quantityInput.value);
            const unit = unitSelect.value;

            if (!food || isNaN(quantity) || quantity <= 0) {
                showToast('Por favor, preencha o nome do alimento e uma quantidade v√°lida.', 'error');
                return;
            }

            addButton.disabled = true;
            loader.classList.remove('hidden');

            try {
                const nutritionalData = await getNutritionalData(food, quantity, unit);

                if (nutritionalData.calories === 0 && nutritionalData.protein === 0 && nutritionalData.carbs === 0 && nutritionalData.fat === 0) {
                    showToast(`N√£o foi poss√≠vel adicionar "${food}" ao template sem dados nutricionais v√°lidos.`, 'error');
                    return;
                }

                const newFoodItem = {
                    food,
                    quantity,
                    unit,
                    calories: nutritionalData.calories,
                    protein: nutritionalData.protein,
                    carbs: nutritionalData.carbs,
                    fat: nutritionalData.fat
                };
                mealTemplates[type][templateIndex].foods.push(newFoodItem);
                updateMealCards();
                saveAllData();
                showToast('Alimento adicionado ao template com sucesso!', 'success');
                foodNameInput.value = '';
                quantityInput.value = '';
            } catch (error) {
                console.error("Erro ao adicionar alimento ao template:", error);
                showToast("Ocorreu um erro ao adicionar o alimento ao template. Tente novamente.", 'error');
            } finally {
                addButton.disabled = false;
                loader.classList.add('hidden');
            }
        };

        window.removeFoodFromTemplate = function(type, templateIndex, foodIndex) {
            if (confirm('Tem certeza que deseja remover este alimento do template?')) {
                if (mealTemplates[type] && mealTemplates[type][templateIndex] && mealTemplates[type][templateIndex].foods[foodIndex]) {
                    mealTemplates[type][templateIndex].foods.splice(foodIndex, 1);
                    updateMealCards();
                    saveAllData();
                    showToast('Alimento removido do template!', 'success');
                }
            }
        };

        window.removeMealTemplate = function(type, index) {
            if (confirm('Tem certeza que deseja remover este template de refei√ß√£o? Todos os alimentos associados ser√£o perdidos.')) {
                if (mealTemplates[type] && mealTemplates[type][index]) {
                    mealTemplates[type].splice(index, 1);
                    if (mealTemplates[type].length === 0) {
                        delete mealTemplates[type];
                    }
                    updateMealCards();
                    saveAllData();
                    showToast('Template de refei√ß√£o removido com sucesso!', 'success');
                }
            }
        };

        let mealDistributionChartInstance;
        function updateMealDistributionChart() {
            if (mealDistributionChartInstance) {
                mealDistributionChartInstance.destroy();
            }
            
            const allMeals = Object.values(meals).flat(); 
            const mealTypesForChart = ['Caf√© da Manh√£', 'Lanche da Manh√£', 'Almo√ßo', 'Lanche da Tarde', 'Jantar', 'Ceia'];
            
            const caloriesPerMealType = mealTypesForChart.map(type => {
                return allMeals
                    .filter(meal => meal.type === type)
                    .reduce((sum, meal) => sum + (meal.calories || 0), 0);
            });

            mealDistributionChartInstance = new Chart(DOM.mealDistributionChartCanvas, {
                type: 'bar',
                data: {
                    labels: mealTypesForChart,
                    datasets: [{
                        label: 'Calorias',
                        data: caloriesPerMealType.map(c => Math.round(c)),
                        backgroundColor: 'rgba(76, 175, 80, 0.7)', // Verde
                        borderColor: 'rgba(76, 175, 80, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        title: { display: true, text: 'Distribui√ß√£o de Calorias por Refei√ß√£o (Hist√≥rico Geral)' },
                        datalabels: {
                            anchor: 'end',
                            align: 'top',
                            formatter: (value) => value > 0 ? `${value} kcal` : '',
                            color: '#4A5568', 
                            font: {
                                weight: 'bold',
                                size: 10
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Calorias' }
                        }
                    }
                },
                plugins: [ChartDataLabels]
            });
        }

        // --- Aba Evolu√ß√£o ---
        let weightChartInstance, waistChartInstance, abdomenChartInstance, hipChartInstance;
        function updateMeasurementCharts() {
            measurements.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            const dates = measurements.map(m => new Date(m.date).toLocaleDateString('pt-BR'));
            
            const createOrUpdateChart = (canvas, label, dataKey, color) => {
                const ctx = canvas.getContext('2d');
                let chartInstance = window[canvas.id + 'Instance'];

                const chartData = measurements.map(m => m[dataKey]);
                const hasData = chartData.some(val => val !== null && val !== undefined && !isNaN(val)); 

                if (!hasData) {
                    if (chartInstance) {
                        chartInstance.destroy();
                        window[canvas.id + 'Instance'] = null;
                    }
                    // Limpa o canvas e exibe uma mensagem
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.font = '16px Arial';
                    ctx.fillStyle = '#9CA3AF'; 
                    ctx.textAlign = 'center';
                    ctx.fillText('Sem dados para exibir o gr√°fico.', canvas.width / 2, canvas.height / 2);
                    return;
                }

                if (chartInstance) {
                    chartInstance.data.labels = dates;
                    chartInstance.data.datasets[0].data = chartData;
                    chartInstance.update();
                } else {
                    chartInstance = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: dates,
                            datasets: [{
                                label: label,
                                data: chartData,
                                backgroundColor: `${color.replace('1)', '0.15)')}`, 
                                borderColor: color,
                                borderWidth: 2,
                                tension: 0.3, 
                                fill: true,
                                pointBackgroundColor: color,
                                pointBorderColor: '#fff',
                                pointBorderWidth: 1,
                                pointRadius: 4,
                                pointHoverRadius: 6
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false,
                                    callbacks: {
                                        label: function(context) {
                                            return `${context.dataset.label}: ${context.parsed.y} ${dataKey === 'weight' ? 'kg' : 'cm'}`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: false,
                                    title: { display: true, text: label, font: { size: 14, weight: 'bold' } },
                                    grid: { color: '#e5e7eb' } 
                                },
                                x: {
                                    title: { display: true, text: 'Data', font: { size: 14, weight: 'bold' } },
                                    grid: { display: false }
                                }
                            }
                        }
                    });
                    window[canvas.id + 'Instance'] = chartInstance;
                }
            };

            createOrUpdateChart(DOM.weightChartCanvas, 'Peso (kg)', 'weight', 'rgba(76, 175, 80, 1)'); // Verde
            createOrUpdateChart(DOM.waistChartCanvas, 'Cintura (cm)', 'waist', 'rgba(33, 150, 243, 1)'); // Azul
            createOrUpdateChart(DOM.abdomenChartCanvas, 'Abd√¥men (cm)', 'abdomen', 'rgba(255, 193, 7, 1)'); // √Çmbar
            createOrUpdateChart(DOM.hipChartCanvas, 'Quadril (cm)', 'hip', 'rgba(139, 195, 74, 1)'); // Verde Claro
            
            updateMeasurementsTable();
        }

        function updateMeasurementsTable() {
            DOM.measurementsHistoryTable.innerHTML = '';
            
            if (measurements.length === 0) {
                DOM.measurementsHistoryTable.innerHTML = '<tr><td colspan="8" class="p-4 text-center text-gray-500">Nenhuma medi√ß√£o registrada</td></tr>';
                return;
            }
            
            const sortedMeasurements = [...measurements].sort((a, b) => new Date(b.date) - new Date(a.date));

            sortedMeasurements.forEach((measurement, index) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition-colors duration-150';
                row.innerHTML = `
                    <td class="p-3 border-b text-sm text-gray-800" data-label="Data">${new Date(measurement.date).toLocaleDateString('pt-BR')}</td>
                    <td class="p-3 border-b text-sm text-gray-800" data-label="Peso (kg)">${measurement.weight ? measurement.weight.toFixed(1) : '-'}</td>
                    <td class="p-3 border-b text-sm text-gray-800" data-label="Cintura (cm)">${measurement.waist ? measurement.waist.toFixed(1) : '-'}</td>
                    <td class="p-3 border-b text-sm text-gray-800" data-label="Abd√¥men (cm)">${measurement.abdomen ? measurement.abdomen.toFixed(1) : '-'}</td>
                    <td class="p-3 border-b text-sm text-gray-800" data-label="Quadril (cm)">${measurement.hip ? measurement.hip.toFixed(1) : '-'}</td>
                    <td class="p-3 border-b text-sm text-gray-800" data-label="Bra√ßo (cm)">${measurement.arm ? measurement.arm.toFixed(1) : '-'}</td>
                    <td class="p-3 border-b text-sm text-gray-800" data-label="Coxa (cm)">${measurement.thigh ? measurement.thigh.toFixed(1) : '-'}</td>
                    <td class="p-3 border-b text-sm text-gray-800" data-label="A√ß√µes">
                        <button class="text-red-500 hover:text-red-700 transition-colors duration-200" onclick="removeMeasurement(${index})" aria-label="Remover medi√ß√£o de ${new Date(measurement.date).toLocaleDateString('pt-BR')}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                        </button>
                    </td>
                `;
                DOM.measurementsHistoryTable.appendChild(row);
            });
        }

        DOM.saveMeasurementBtn.addEventListener('click', () => {
            const date = document.getElementById('measurement-date').value;
            const weight = parseFloat(document.getElementById('measurement-weight').value);
            const waist = parseFloat(document.getElementById('measurement-waist').value);
            const abdomen = parseFloat(document.getElementById('measurement-abdomen').value);
            const hip = parseFloat(document.getElementById('measurement-hip').value);
            const arm = parseFloat(document.getElementById('measurement-arm').value);
            const thigh = parseFloat(document.getElementById('measurement-thigh').value);
            const chest = parseFloat(document.getElementById('measurement-chest').value);
            
            if (!date || isNaN(weight) || weight <= 0) {
                showToast('Por favor, preencha pelo menos a data e o peso com valores num√©ricos positivos v√°lidos.', 'error');
                return;
            }
            
            const newMeasurement = {
                date,
                weight,
                waist: isNaN(waist) ? null : waist,
                abdomen: isNaN(abdomen) ? null : abdomen,
                hip: isNaN(hip) ? null : hip,
                arm: isNaN(arm) ? null : arm,
                thigh: isNaN(thigh) ? null : thigh,
                chest: isNaN(chest) ? null : chest
            };
            
            const existingIndex = measurements.findIndex(m => m.date === date);
            if (existingIndex >= 0) {
                measurements[existingIndex] = newMeasurement;
            } else {
                measurements.push(newMeasurement);
            }
            
            measurements.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            updateMeasurementCharts();
            DOM.measurementsForm.reset();
            saveAllData();
            showToast('Medi√ß√£o salva com sucesso!', 'success');
        });

        window.removeMeasurement = function(index) {
            if (confirm('Tem certeza que deseja remover esta medi√ß√£o?')) {
                const sortedMeasurementsForDisplay = [...measurements].sort((a, b) => new Date(b.date) - new Date(a.date));
                const measurementToRemove = sortedMeasurementsForDisplay[index];
                
                const originalIndex = measurements.findIndex(m => 
                    m.date === measurementToRemove.date && 
                    m.weight === measurementToRemove.weight &&
                    m.waist === measurementToRemove.waist 
                );
                
                if (originalIndex > -1) {
                    measurements.splice(originalIndex, 1);
                    updateMeasurementCharts();
                    saveAllData();
                    showToast('Medi√ß√£o removida com sucesso!', 'success');
                } else {
                    console.error("Erro: Medi√ß√£o n√£o encontrada para remo√ß√£o no √≠ndice original.");
                    showToast("Erro ao remover medi√ß√£o.", 'error');
                }
            }
        };

        // --- Fun√ß√µes de Anima√ß√£o ---
        function animateProgressBar(barElement, targetPercent) {
            let currentPercent = 0;
            const duration = 500; 
            const stepTime = 10; 
            const steps = duration / stepTime;
            const increment = targetPercent / steps;

            barElement.classList.remove('animate-pulse-custom', 'over-target');
            barElement.style.width = '0%';

            let startTime = null;

            function animate(currentTime) {
                if (!startTime) startTime = currentTime;
                const progress = (currentTime - startTime) / duration;

                if (progress < 1) {
                    currentPercent = increment * (progress * steps);
                    barElement.style.width = `${Math.min(100, currentPercent)}%`;
                    requestAnimationFrame(animate);
                } else {
                    barElement.style.width = `${Math.min(100, targetPercent)}%`;
                    if (targetPercent >= 100) {
                        barElement.classList.add('animate-pulse-custom');
                        if (targetPercent > 100) {
                            barElement.classList.add('over-target');
                        }
                    }
                }
            }
            requestAnimationFrame(animate);
        }
        
        // --- Aba Di√°rio ---
        DOM.saveJournalBtn.addEventListener('click', function() {
            const date = document.getElementById('journal-date').value;
            const good = document.getElementById('journal-good').value.trim();
            const improve = document.getElementById('journal-improve').value.trim();
            const focus = document.getElementById('journal-focus').value.trim();
            const rating = parseInt(document.getElementById('journal-rating').value);
            const notes = document.getElementById('journal-notes').value.trim();
            
            if (!date || !good || !improve || !focus || isNaN(rating) || rating < 0 || rating > 10) {
                showToast('Por favor, preencha todos os campos obrigat√≥rios do di√°rio com valores v√°lidos (Nota de 0 a 10).', 'error');
                return;
            }
            
            const newEntry = {
                date,
                good,
                improve,
                focus,
                rating,
                notes
            };
            
            const existingIndex = journalEntries.findIndex(e => e.date === date);
            if (existingIndex >= 0) {
                journalEntries[existingIndex] = newEntry;
            } else {
                journalEntries.push(newEntry);
            }
            
            document.getElementById('journal-good').value = '';
            document.getElementById('journal-improve').value = '';
            document.getElementById('journal-focus').value = '';
            document.getElementById('journal-rating').value = '';
            document.getElementById('journal-notes').value = '';
            
            saveAllData();
            showToast('Registro salvo no di√°rio!', 'success');
        });

        // --- Aba Feedback ---
        DOM.starButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                currentRating = parseInt(this.getAttribute('data-rating'));
                updateStarRatingDisplay();
            });
        });

        function updateStarRatingDisplay() {
            DOM.starButtons.forEach((star, index) => {
                if (index < currentRating) {
                    star.classList.add('selected');
                } else {
                    star.classList.remove('selected');
                }
            });
            DOM.ratingText.textContent = `${currentRating}/5 estrelas`;
        }

        DOM.saveFeedbackBtn.addEventListener('click', function() {
            const positive = document.getElementById('feedback-positive').value.trim();
            const improve = document.getElementById('feedback-improve').value.trim();
            const comments = document.getElementById('feedback-comments').value.trim();
            
            if (currentRating === 0) {
                showToast('Por favor, selecione uma avalia√ß√£o de estrelas.', 'error');
                return;
            }
            
            const newFeedback = {
                rating: currentRating,
                positive,
                improve,
                comments,
                date: new Date().toISOString().split('T')[0]
            };
            
            feedbackData.push(newFeedback);
            showToast('Obrigado pelo seu feedback!', 'success');
            document.getElementById('feedback-positive').value = '';
            document.getElementById('feedback-improve').value = '';
            document.getElementById('feedback-comments').value = '';
            currentRating = 0;
            updateStarRatingDisplay();
            saveAllData();
        });

        // --- Inicializa√ß√£o da Aplica√ß√£o ---
        function initializeApp() {
            loadAllData(); // Carrega dados do localStorage
            updateCurrentDateDisplay(); 

            // Preenche os campos do formul√°rio de dados pessoais com os dados carregados
            document.getElementById('gender').value = userData.gender || 'M';
            document.getElementById('age').value = userData.age || '';
            document.getElementById('height').value = userData.height || '';
            document.getElementById('weight').value = userData.weight || '';
            document.getElementById('activity').value = userData.activity || '1.2';
            document.getElementById('goal').value = userData.goal || '-0.2';
            document.getElementById('protein-percentage').value = userData.proteinPercent;
            document.getElementById('carbs-percentage').value = userData.carbsPercent;
            document.getElementById('fat-percentage').value = userData.fatPercent;

            // Se houver dados de perfil, recalcula e exibe
            if (userData.dailyCalories > 0) {
                DOM.calculateBtn.click(); 
            }

            updateMealCards();
            updateMeasurementCharts();
            updateStarRatingDisplay();
            activateTab('dados-pessoais');
        }

        // Garantir que o DOM esteja totalmente carregado antes de inicializar a aplica√ß√£o
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
